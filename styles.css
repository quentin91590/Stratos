:root{
  --sticky-top: 60px;   /* garde tes autres usages éventuels */
  --sidebar-top: 0px;   /* spécifique sidebar */
  --bg:#f6f7f9; --card:#ffffff; --ink:#101828; --muted:#667085; --border:#e5e7eb; --ring: rgba(39,125,161,.35);
  --sticky-top: 60px;
  /* palette */
  --c-red:#F94144; --c-orange-1:#F3722C; --c-orange-2:#F8961E; --c-orange-3:#F9844A; --c-yellow:#F9C74F;
  --c-green:#90BE6D; --c-teal:#43AA8B; --c-teal-muted:#4D908E; --c-blue-soft:#577590; --c-blue-deep:#277DA1;
  /* energy accents */
  --energy-chaleur:var(--c-red);
  --energy-chaleur-soft:color-mix(in srgb, var(--energy-chaleur) 70%, white);
  --energy-chaleur-shadow:color-mix(in srgb, var(--energy-chaleur) 26%, transparent);
  --energy-electricite:var(--c-yellow);
  --energy-electricite-soft:color-mix(in srgb, var(--energy-electricite) 68%, white);
  --energy-electricite-shadow:color-mix(in srgb, var(--energy-electricite) 26%, transparent);
  --energy-froid:var(--c-blue-deep);
  --energy-froid-soft:color-mix(in srgb, var(--energy-froid) 60%, white);
  --energy-froid-shadow:color-mix(in srgb, var(--energy-froid) 24%, transparent);
  --section-color:var(--c-blue-soft);
  /* sections */
  --sec-energie:var(--c-blue-deep); --sec-travaux:var(--c-orange-1); --sec-financier:var(--c-yellow); --sec-etat:var(--c-teal);
  /* états KPI */
  --kpi-good:var(--c-green); --kpi-warn:var(--c-yellow); --kpi-bad:var(--c-red);
  /* largeurs (priorité au bas) */
  --container-max: 1600px;
  --content-max:   1520px;
}

*{box-sizing:border-box}
body{background:var(--bg); color:var(--ink); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; overflow-x:hidden;}

/* ======= KPI cards ======= */
.kpi-wrap{max-width:1200px; margin:24px auto; padding:0 16px}
.kpi-tabs{display:grid; grid-template-columns:repeat(6,minmax(170px,1fr)); gap:12px; align-items:stretch}

.kpi{
  --status:#8a8a8a; --tint:rgba(0,0,0,.04);
  position:relative; display:grid; grid-template-rows:auto auto 1fr auto; gap:6px; padding:16px; border-radius:16px;
  background:var(--card); border:1px solid var(--border); cursor:pointer; text-align:center; justify-items:center;
  transition:transform .14s ease, box-shadow .14s ease, border-color .14s ease;
  box-shadow:0 1px 0 rgba(0,0,0,.02), 0 8px 24px rgba(16,24,40,.06);
}
.kpi[data-status="good"]{--status:var(--kpi-good); --tint:rgba(144,190,109,.18)}
.kpi[data-status="warn"]{--status:var(--kpi-warn); --tint:rgba(249,199,79,.2)}
.kpi[data-status="bad"]{--status:var(--kpi-bad); --tint:rgba(249,65,68,.18)}

.kpi-label{font-size:1.05rem; font-weight:700; letter-spacing:.01em; color:#1f2937; min-height:1.6rem}
.kpi-title{font-size:.95rem; margin-top:2px; color:#334155; min-height:2.0rem}
.kpi-value-wrap{
  --value-base: clamp(1.45rem, 2.4vw, 2.35rem);
  --value-size: var(--value-base);
  display:grid;
  grid-template-columns:auto auto;
  align-items:center;
  justify-content:center;
  justify-items:center;
  gap:12px;
  width:100%;
  min-height:2.6rem;
}
.kpi-value{
  position:relative;
  margin:0;
  font-size:var(--value-size);
  font-weight:800;
  line-height:1.08;
  font-variant-numeric:tabular-nums;
  letter-spacing:-0.01em;
  color:var(--status);
  white-space:nowrap;
  justify-self:center;
  text-align:center;
}
.kpi-trend{
  position:relative;
  right:auto;
  top:auto;
  transform:none;
  font-size:.75rem;
  font-weight:700;
  white-space:nowrap;
  justify-self:start;
}
.trend-up{color:var(--kpi-good)}
.trend-down{color:var(--kpi-bad)}
@keyframes up2{0%{transform:translateY(0)}35%{transform:translateY(-4px)}55%{transform:translateY(0)}75%{transform:translateY(-2px)}100%{transform:translateY(0)}}
@keyframes down2{0%{transform:translateY(0)}35%{transform:translateY(4px)}55%{transform:translateY(0)}75%{transform:translateY(2px)}100%{transform:translateY(0)}}
.arr{display:inline-block;} .animate-up{animation:up2 .9s ease-out both;} .animate-down{animation:down2 .9s ease-out both;}
.kpi-unit{font-size:.85rem; color:var(--muted); min-height:1.4rem}

.kpi:focus-visible{outline:none; box-shadow:0 0 0 6px var(--ring)}
.kpi[aria-selected="true"]{transform:translateY(-4px) scale(1.02); border-color:#cbd5e1; box-shadow:0 10px 28px rgba(16,24,40,.14), 0 0 0 2px var(--status) inset;}
.kpi[aria-selected="true"] .kpi-icon{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; background:var(--tint); color:var(--status);}
.kpi-dot{position:absolute; top:10px; right:10px; width:14px; height:14px; border-radius:999px; background:var(--status); box-shadow:0 0 0 4px var(--tint), 0 0 0 1px rgba(0,0,0,.08) inset, 0 0 4px var(--status), 0 0 10px var(--status);}
.kpi[aria-selected="true"] .kpi-dot{box-shadow:0 0 0 6px var(--tint), 0 0 0 2px var(--status) inset, 0 0 6px var(--status), 0 0 14px var(--status);}
.kpi[aria-selected="true"] .kpi-title{color:#111827;}

.kpi-head{display:flex; align-items:center; justify-content:center; gap:8px}
.kpi-icon{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; background:var(--tint); color:var(--status);}

.kpi:not([aria-selected="true"]) {opacity:.78; filter:saturate(.9)}
.kpi:hover{transform:translateY(-2px)}
@media (max-width: 1100px){ .kpi-tabs{grid-template-columns:repeat(3,1fr)} }
@media (max-width: 640px){ .kpi-tabs{grid-template-columns:1fr 1fr} .kpi{padding:12px} .kpi-value-wrap{gap:8px} }

.panel-summary{display:flex; flex-wrap:wrap; gap:10px 12px; margin:6px 0 12px}
.pill{display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#f8fafc; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(16,24,40,.04)}
.pill-ico svg{display:block}
.pill-label{font-size:.85rem; color:#64748b}
.pill-value{font-size:1.05rem; font-weight:800; letter-spacing:-0.01em; font-variant-numeric: tabular-nums}
.pill-unit{font-size:.8rem; color:#94a3b8; margin-left:2px}

/* ======= Top nav ======= */
.top-nav-wrap{
  position:sticky;
  top:0;
  z-index:1000;
  display:flex;
  flex-direction:column;
  gap:8px;
  margin:0 0 24px;
  padding:12px 0 14px;
  background:rgba(246,247,249,.94);
  border-bottom:1px solid rgba(15,23,42,.08);
  box-shadow:0 10px 35px rgba(15,23,42,.08);
  backdrop-filter:blur(10px);
}
.top-nav{
  display:flex;
  gap:20px;
  margin:0;
  padding:0 0 4px;
  border:none;
  border-radius:0;
  background:transparent;
  align-items:center;
  flex-wrap:wrap;
  width:100%;
  justify-content:flex-start;
  overflow:visible;
}
.top-item{
  appearance:none; border:none; background:transparent; color:#0f172a;
  /* échelle locale, 1 par défaut */
  --top-scale: 1;
  padding: calc(8px * var(--top-scale)) calc(6px * var(--top-scale));
  border-radius:0; font-weight:700; font-size: calc(.95rem * var(--top-scale));
  cursor:pointer; display:flex; align-items:center; gap: calc(8px * var(--top-scale));
  position:relative;
}
.top-nav > .top-item:nth-of-type(2),
.top-nav > .top-item:nth-child(2),
.top-nav > *:nth-child(2) .top-item,
.top-nav > .top-item:nth-of-type(3),
.top-nav > .top-item:nth-child(3),
.top-nav > *:nth-child(3) .top-item,
.top-nav > .top-item:nth-of-type(4),
.top-nav > .top-item:nth-child(4),
.top-nav > *:nth-child(4) .top-item,
.top-nav > .top-item:nth-of-type(5),
.top-nav > .top-item:nth-child(5),
.top-nav > *:nth-child(5) .top-item{
  --top-scale: 1.2;
}

.top-item:focus-visible{outline:none; box-shadow:0 0 0 6px var(--ring)}
.top-item.is-active::after{
  content:""; position:absolute; left:0; right:0; bottom:-10px; height:3px; border-radius:2px; background:var(--section-color, var(--c-blue-deep));
}
.top-item:hover{opacity:.9}
.top-item.is-active{color:#0f172a}
@media (max-width:640px){ .top-nav{flex-wrap:nowrap; gap:14px; margin-bottom:0} }

@media (max-width:640px){ .top-subnav{flex-wrap:nowrap;} }

.top-subnav[hidden]{display:none}
.top-subnav{
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap:wrap;
  width:100%;
  margin:0;
  padding:12px 0 4px;
  border-top:1px solid rgba(15,23,42,.08);
  opacity:0;
  transform:translateY(-12px);
  pointer-events:none;
  transition:opacity .28s ease, transform .32s cubic-bezier(.33,1,.68,1);
  overflow-x:auto;
  scrollbar-width:thin;
  -webkit-overflow-scrolling:touch;
}
.top-subnav.is-visible{
  opacity:1;
  transform:translateY(0);
  pointer-events:auto;
}
.top-subnav::-webkit-scrollbar{height:6px}
.top-subnav::-webkit-scrollbar-thumb{background:rgba(15,23,42,.18); border-radius:999px}
.top-subnav-item{
  --accent:var(--c-blue-deep);
  --accent-soft:rgba(39,125,161,.18);
  --accent-strong:rgba(39,125,161,.32);
  appearance:none;
  border:2px solid transparent;
  background:#fff;
  color:var(--accent);
  padding:12px 18px;
  border-radius:16px;
  display:inline-flex;
  align-items:center;
  gap:12px;
  font-weight:700;
  font-size:.92rem;
  letter-spacing:.01em;
  cursor:pointer;
  transition:transform .22s ease, box-shadow .24s ease, background .24s ease, color .24s ease, border-color .24s ease;
  box-shadow:0 8px 22px var(--accent-soft);
}
.top-subnav-item .top-subnav-icon{
  display:inline-flex;
  width:28px;
  height:28px;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  background:var(--accent-soft);
  color:inherit;
}
.top-subnav-item .top-subnav-icon svg{width:18px; height:18px; display:block}
.top-subnav-item .top-subnav-text{white-space:nowrap; display:inline-flex; align-items:center;}
.top-subnav-item:hover{transform:translateY(-4px); box-shadow:0 16px 30px var(--accent-strong);}
.top-subnav-item.is-active{
  border-color:var(--accent);
  color:var(--accent);
  background:#fff;
  box-shadow:0 18px 34px var(--accent-strong);
}
.top-subnav-item.is-active .top-subnav-icon{
  background:var(--accent-strong);
  color:var(--accent);
}
.top-subnav-item.is-active svg{stroke:currentColor;}
.top-subnav-item:focus-visible{outline:none; box-shadow:0 0 0 4px var(--ring), 0 18px 34px var(--accent-strong);}

.kpi-subnav-sentinel{position:relative; height:1px; margin-top:-1px; pointer-events:none;}

.section{margin-top:18px}
.section[hidden]{display:none}

/* Panels */
.kpi-panels{margin-top:18px; background:transparent; border:none; border-radius:16px; padding:16px 0 0; box-shadow:none}
.kpi-panels section[hidden]{display:none}
.kpi-panels h3{margin:.2rem 0 .4rem 0}
.meter{height:10px; background:#eef2f6; border-radius:8px; overflow:hidden; border:1px solid var(--border)}
.meter > div{height:100%; width:0; background:var(--active-color, #94a3b8)}

.energy-trend-chart{
  margin:20px 0 0;
  padding:18px 20px 16px;
  border:1px solid var(--border);
  border-radius:16px;
  background:var(--card);
  box-shadow:0 6px 16px rgba(15,23,42,0.06);
  position:relative;
}
.energy-trend-chart .chart-body{display:flex; flex-direction:column; gap:18px}
.chart-variant{display:flex; flex-direction:column; gap:16px}
.chart-title{display:flex; flex-direction:column; align-items:flex-start; gap:6px; font-weight:700; color:#1f2937; padding-right:64px}
.chart-unit{font-size:.9rem; color:#475569; font-weight:600}
.chart-bars{
  --bar-scale:0.7px;
  display:flex;
  align-items:flex-end;
  gap:18px;
  margin-top:16px;
  padding:8px 0 0;
  min-height:160px;
}
.chart-bar{flex:1; display:flex; flex-direction:column; align-items:center; gap:8px; font-variant-numeric:tabular-nums; color:#0f172a}
.chart-bar .bar-value{font-weight:700; font-size:1rem}
.chart-bar .bar-fill{
  width:100%;
  height:calc(var(--value) * var(--bar-scale));
  background:linear-gradient(180deg, var(--c-blue-soft), var(--c-blue-deep));
  border-radius:10px 10px 6px 6px;
  box-shadow:0 6px 14px rgba(39,125,161,0.25);
}
.chart-bar.is-selected .bar-fill{
  background:linear-gradient(180deg, var(--c-orange-1), var(--c-orange-2));
  box-shadow:0 6px 16px rgba(243,114,44,0.3);
}
.chart-bar.is-selected .bar-value{color:var(--c-orange-1);}
.chart-bar .bar-year{font-size:.85rem; color:#475569; letter-spacing:.02em}
.chart-line{position:relative; width:100%;}
.chart-line svg{width:100%; height:200px; display:block}
.chart-line .line-area{fill:url(#lineArea);}
.chart-line .line-path{fill:none; stroke:var(--c-blue-deep); stroke-width:4; stroke-linecap:round; stroke-linejoin:round; filter:drop-shadow(0 6px 14px rgba(39,125,161,0.35))}
.chart-line .line-target{stroke:var(--c-orange-1); stroke-width:3; stroke-dasharray:10 8; opacity:.8}
.chart-variant--pareto{gap:18px; --pareto-bar-color:var(--c-blue-deep); --pareto-line-color:var(--c-blue-soft); --pareto-bar-shadow:rgba(39,125,161,0.2); --pareto-line-shadow:rgba(87,117,144,0.2)}
.chart-variant--pareto .chart-title{padding-right:0}
figure[data-chart-scope="chaleur"] .chart-variant--pareto{--pareto-bar-color:var(--energy-chaleur); --pareto-line-color:var(--energy-chaleur-soft); --pareto-bar-shadow:color-mix(in srgb, var(--energy-chaleur) 28%, transparent); --pareto-line-shadow:color-mix(in srgb, var(--energy-chaleur-soft) 26%, transparent)}
figure[data-chart-scope="froid"] .chart-variant--pareto{--pareto-bar-color:var(--energy-froid); --pareto-line-color:var(--energy-froid-soft); --pareto-bar-shadow:color-mix(in srgb, var(--energy-froid) 26%, transparent); --pareto-line-shadow:color-mix(in srgb, var(--energy-froid-soft) 24%, transparent)}
figure[data-chart-scope="elec"] .chart-variant--pareto{--pareto-bar-color:var(--energy-electricite); --pareto-line-color:var(--energy-electricite-soft); --pareto-bar-shadow:color-mix(in srgb, var(--energy-electricite) 30%, transparent); --pareto-line-shadow:color-mix(in srgb, var(--energy-electricite-soft) 28%, transparent)}
figure[data-chart-scope="co2"] .chart-variant--pareto{--pareto-bar-color:var(--c-green); --pareto-line-color:var(--c-teal); --pareto-bar-shadow:rgba(144,190,109,0.22); --pareto-line-shadow:rgba(67,170,139,0.2)}
figure[data-chart-scope="eau"] .chart-variant--pareto{--pareto-bar-color:var(--c-blue-deep); --pareto-line-color:var(--c-teal-muted); --pareto-bar-shadow:rgba(39,125,161,0.22); --pareto-line-shadow:rgba(77,144,142,0.22)}
figure[data-chart-slot="general-pareto"][data-pareto-metric="chaleur"] .chart-variant--pareto{--pareto-bar-color:var(--energy-chaleur); --pareto-line-color:var(--energy-chaleur-soft); --pareto-bar-shadow:color-mix(in srgb, var(--energy-chaleur) 28%, transparent); --pareto-line-shadow:color-mix(in srgb, var(--energy-chaleur-soft) 26%, transparent)}
figure[data-chart-slot="general-pareto"][data-pareto-metric="froid"] .chart-variant--pareto{--pareto-bar-color:var(--energy-froid); --pareto-line-color:var(--energy-froid-soft); --pareto-bar-shadow:color-mix(in srgb, var(--energy-froid) 26%, transparent); --pareto-line-shadow:color-mix(in srgb, var(--energy-froid-soft) 24%, transparent)}
figure[data-chart-slot="general-pareto"][data-pareto-metric="elec"] .chart-variant--pareto{--pareto-bar-color:var(--energy-electricite); --pareto-line-color:var(--energy-electricite-soft); --pareto-bar-shadow:color-mix(in srgb, var(--energy-electricite) 30%, transparent); --pareto-line-shadow:color-mix(in srgb, var(--energy-electricite-soft) 28%, transparent)}
figure[data-chart-slot="general-pareto"][data-pareto-metric="co2"] .chart-variant--pareto{--pareto-bar-color:var(--c-green); --pareto-line-color:var(--c-teal); --pareto-bar-shadow:rgba(144,190,109,0.22); --pareto-line-shadow:rgba(67,170,139,0.2)}
figure[data-chart-slot="general-pareto"][data-pareto-metric="eau"] .chart-variant--pareto{--pareto-bar-color:var(--c-blue-deep); --pareto-line-color:var(--c-teal-muted); --pareto-bar-shadow:rgba(39,125,161,0.22); --pareto-line-shadow:rgba(77,144,142,0.22)}
.energy-chart-stack > [data-chart-slot][data-chart-type$="pareto"]{grid-column:1 / -1}
.energy-chart-card .chart-body{display:flex; flex-direction:column; gap:18px; padding:0}
.energy-chart-card .chart-body > .chart-variant{flex:1 1 auto; display:flex; flex-direction:column; gap:18px}
.energy-chart-card .chart-body > .chart-variant .pareto-chart{flex:1 1 auto}
.pareto-chart{position:relative; width:100%; height:clamp(220px, 42vh, 320px); border-radius:16px; border:1px solid var(--border); background-color:var(--card); padding:12px var(--pareto-right-gap, 40px) 32px var(--pareto-left-gap, 68px); overflow:visible; --pareto-left-gap: 68px; --pareto-right-gap: 40px;}
.pareto-chart::before{content:""; position:absolute; inset:12px 0 36px 0; border-radius:12px; pointer-events:none; background:repeating-linear-gradient(to top, rgba(148,163,184,0.18) 0px, rgba(148,163,184,0.18) 1px, transparent 1px, transparent var(--pareto-scale-step, 25%)), repeating-linear-gradient(to right, rgba(148,163,184,0.08) 0px, rgba(148,163,184,0.08) 1px, transparent 1px, transparent 12.5%); z-index:0;}
.pareto-chart__inner{position:absolute; inset:12px 0 36px 0; overflow:visible; z-index:1}
.pareto-chart__bars{position:absolute; inset:0; display:grid; grid-template-columns:repeat(var(--pareto-count, 1), minmax(12px, 1fr)); gap:6px; align-items:flex-end; min-height:100%; z-index:10}
.pareto-chart__bars.is-empty{display:flex; align-items:center; justify-content:center; padding:0 16px}
.pareto-chart__bars.is-empty .chart-empty{margin:0}
.pareto-chart__bar{--value:0; --pareto-label-width:160px; position:relative; height:calc(var(--value) * 1%); min-height:2px; border-radius:9px 9px 6px 6px; background:linear-gradient(180deg, rgba(255,255,255,0.36), rgba(255,255,255,0)) , var(--pareto-bar-color, var(--c-blue-deep)); box-shadow:0 10px 22px var(--pareto-bar-shadow, rgba(39,125,161,0.2)); transition:transform .18s ease, box-shadow .18s ease; outline:none; pointer-events:auto}
.pareto-chart__bar--interactive{cursor:pointer}
.pareto-chart__bar.is-dimmed{background:linear-gradient(180deg, rgba(226,232,240,0.48), rgba(203,213,225,0.12)) , rgba(148,163,184,0.6); box-shadow:0 6px 16px rgba(148,163,184,0.28); opacity:.55}
.pareto-chart__bar.is-dimmed:hover,.pareto-chart__bar.is-dimmed:focus-visible{transform:none; box-shadow:0 6px 16px rgba(148,163,184,0.28)}
.pareto-chart__bar:hover,.pareto-chart__bar:focus-visible{transform:translateY(-4px); box-shadow:0 14px 30px var(--pareto-bar-shadow, rgba(39,125,161,0.2))}
.pareto-chart__bar:focus-visible{box-shadow:0 0 0 4px var(--ring, rgba(39,125,161,0.32)), 0 14px 30px var(--pareto-bar-shadow, rgba(39,125,161,0.2))}
.pareto-chart__tooltip-layer{position:absolute; inset:0; pointer-events:none; z-index:160; overflow:visible}
.pareto-chart__tooltip{position:absolute; left:var(--tooltip-left, 50%); bottom:calc(var(--tooltip-bottom, 100%) + 32px); transform:translate(-50%, 12px); opacity:0; pointer-events:none; transition:opacity .18s ease, transform .18s ease; display:flex; flex-direction:column; align-items:center; gap:10px; z-index:1;}
.pareto-chart__tooltip-value{background:#fff; color:#0f172a; font-size:.72rem; font-weight:600; padding:4px 10px; border-radius:6px; box-shadow:0 8px 18px rgba(15,23,42,0.18); white-space:nowrap; text-align:center;}
.pareto-chart__tooltip-label{background:rgba(15,23,42,0.94); color:#fff; font-size:.72rem; font-weight:600; padding:4px 10px; border-radius:6px; box-shadow:0 8px 18px rgba(15,23,42,0.26); line-height:1.3; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; text-align:center; width:min(var(--pareto-label-width, 160px), 85vw); inline-size:min(var(--pareto-label-width, 160px), 85vw); min-inline-size:min(var(--pareto-label-width, 160px), 85vw); max-inline-size:min(var(--pareto-label-width, 160px), 85vw); overflow-wrap:anywhere; word-break:break-word;}
.pareto-chart__tooltip-note{background:rgba(148,163,184,0.2); color:rgba(15,23,42,0.78); font-size:.62rem; font-weight:700; padding:3px 10px; border-radius:999px; text-transform:uppercase; letter-spacing:.08em; white-space:nowrap}
.pareto-chart__tooltip[data-visible="true"]{opacity:1; transform:translate(-50%, 0)}
.pareto-chart__line{position:absolute; inset:0; pointer-events:none; z-index:20; width:100%; height:100%; overflow:hidden}
.pareto-chart__line[hidden]{display:none}
.pareto-chart__line [data-pareto-polyline]{fill:none; stroke:var(--pareto-line-color, var(--c-blue-soft)); stroke-width:2.6; stroke-linecap:butt; stroke-linejoin:round; filter:drop-shadow(0 6px 14px var(--pareto-line-shadow, rgba(87,117,144,0.2)))}
.pareto-chart__markers{position:absolute; inset:0; z-index:30; pointer-events:none}
.pareto-chart__marker{position:absolute; left:calc(var(--x, 0) * 1%); top:calc(var(--y, 0) * 1%); transform:translate(-50%, -50%); width:12px; height:12px; border-radius:50%; background:var(--pareto-line-color, var(--c-blue-soft)); border:2px solid #fff; box-shadow:0 6px 12px rgba(15,23,42,0.18); pointer-events:auto; outline:none}
.pareto-chart__marker::after{content:attr(data-share); position:absolute; left:50%; bottom:calc(100% + 8px); transform:translate(-50%, 6px); background:#fff; color:#0f172a; font-size:.68rem; font-weight:600; padding:4px 8px; border-radius:6px; box-shadow:0 6px 16px rgba(15,23,42,0.16); white-space:nowrap; opacity:0; transition:opacity .16s ease, transform .16s ease; z-index:20}
.pareto-chart__marker:hover::after,
.pareto-chart__marker:focus-visible::after{opacity:1; transform:translate(-50%, 0)}
.pareto-chart__marker:focus-visible{box-shadow:0 0 0 4px var(--ring, rgba(39,125,161,0.28)), 0 6px 12px rgba(15,23,42,0.18)}
.pareto-chart__markers[hidden]{display:none}
.pareto-chart__scale{position:absolute; inset:12px 12px 36px auto; display:flex; flex-direction:column; justify-content:space-between; align-items:flex-end; gap:0; padding:0; margin:0; list-style:none; font-size:.68rem; font-weight:600; color:rgba(15,23,42,0.52); pointer-events:none; text-shadow:0 1px 2px rgba(255,255,255,0.6)}
.pareto-chart__scale li:first-child:not(:only-child){transform:translateY(-0.34em)}
.pareto-chart__scale li:last-child:not(:only-child){transform:translateY(0.34em)}
.pareto-chart__scale--values{inset:12px auto 0 12px; align-items:flex-start; text-align:left; transform:none;}
.pareto-chart__scale--values li{text-align:left}
.pareto-chart__scale--values[hidden]{display:none}
.pareto-chart__scale li{display:block; line-height:1; letter-spacing:-0.01em}
.chart-note{font-size:.85rem; color:#475569; margin:0}
.chart-footer{display:flex; flex-wrap:wrap; gap:12px; font-size:.9rem; color:#475569; font-weight:600}
.chart-footer span{display:flex; align-items:center; gap:6px}
.line-legend{list-style:none; margin:12px 0 0; padding:0; display:flex; gap:18px; font-size:.85rem; color:#475569; font-weight:600}
.line-legend .dot{display:inline-flex; width:10px; height:10px; border-radius:50%; margin-right:6px; box-shadow:0 0 0 1px rgba(15,23,42,0.12)}
.dot--line{background:var(--c-blue-deep)}
.dot--target{background:var(--c-orange-1)}
.chart-breakdown{display:flex; flex-direction:column; gap:12px; margin-top:4px}
.breakdown-row{display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center; font-size:.9rem; color:#334155; font-variant-numeric:tabular-nums}
.breakdown-label{font-weight:600}
.breakdown-bar{background:#e2e8f0; border-radius:999px; height:10px; position:relative; overflow:hidden}
.breakdown-bar span{position:absolute; inset:1px; border-radius:999px; background:linear-gradient(90deg, var(--c-blue-soft), var(--c-blue-deep)); width:calc(var(--value,0) * 1%)}
.breakdown-row:nth-child(2) .breakdown-bar span{background:linear-gradient(90deg, var(--c-teal-muted), var(--c-teal))}
.breakdown-row:nth-child(3) .breakdown-bar span{background:linear-gradient(90deg, var(--c-green), var(--c-teal))}
.breakdown-row:nth-child(4) .breakdown-bar span{background:linear-gradient(90deg, var(--c-orange-1), var(--c-orange-2))}
.breakdown-value{font-weight:700; color:#0f172a}
.energy-trend-chart figcaption{margin-top:12px; font-size:.85rem; color:#475569; text-align:center}
.energy-chart-card figcaption{margin:0; font-size:.78rem; color:#64748b}
.chart-empty{font-size:.9rem; color:#94a3b8; text-align:center; margin:16px 0;}


@media (max-width: 1024px){
  .mix-pie{max-width:min(140px, 60vw)}
  .energy-chart-stack{grid-template-columns:repeat(2, minmax(0, 1fr))}
}

@media (max-width: 860px){
  .energy-chart-stack{grid-template-columns:1fr; grid-auto-rows:auto}
  .energy-chart-stack > [data-chart-slot]{grid-row:auto}
}

@media (max-width: 720px){
  .mix-variant--pie{grid-template-columns:minmax(0, 1fr); justify-items:center}
  .mix-legend{justify-items:center}
}

.energy-chart-zone{
  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap:24px;
  position:relative;
  isolation:isolate;
  --catalog-top: 12px;
  --catalog-right: 0px;
  --catalog-closed-offset-y: 12px;
  --section-color:var(--c-blue-deep);
}
.heat-chart-zone{--section-color:var(--energy-chaleur)}
.cold-chart-zone{--section-color:var(--energy-froid)}
.elec-chart-zone{--section-color:var(--energy-electricite)}
.co2-chart-zone{--section-color:var(--c-red)}
.energy-chart-wrapper{position:relative; flex:1 1 420px; min-width:0}
.energy-chart-stack{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:20px;
  align-items:start;
  grid-auto-rows:auto;
}
.energy-chart-stack > [data-chart-slot]{
  align-self:stretch;
  min-height:var(--tile-equal-height, auto);
}
.energy-chart-stack > [data-chart-slot][data-tile-width="full"]{grid-column:1 / -1}
.energy-chart-stack > [data-chart-slot][data-tile-width="half"]{grid-column:auto}
.energy-chart-stack > [data-chart-slot]{min-height:var(--tile-equal-height, 0); height:auto}
.energy-mix-card,
.energy-ranking-card,
.energy-typology-card,
.energy-map-card,
.energy-monthly-card,
.energy-distribution-card,
.energy-chart-card{position:relative; padding:20px 22px; border:1px solid var(--border); border-radius:16px; background:var(--card); box-shadow:0 6px 16px rgba(15,23,42,0.06); display:grid; grid-template-rows:auto 1fr auto; gap:16px; min-height:0; min-width:0; justify-self:stretch; width:100%; margin:0; height:auto}
.energy-mix-header{display:flex; justify-content:space-between; align-items:flex-start; gap:12px; font-weight:700; color:#1f2937; padding-right:56px}
.energy-mix-header__titles{display:flex; flex-direction:column; gap:4px}
.mix-title{font-size:1.05rem; letter-spacing:-0.01em}
.mix-subtitle{font-size:.85rem; color:#64748b; font-weight:600}
.energy-chart-card__header{display:flex; justify-content:space-between; align-items:flex-start; gap:12px; font-weight:700; color:#1f2937; padding-right:56px}
.energy-chart-card__titles{display:flex; flex-direction:column; gap:4px}
.energy-chart-card__controls{position:relative; display:inline-flex; align-items:center; min-width:0}
.energy-chart-card__controls::after{content:""; position:absolute; right:14px; width:0; height:0; border-left:5px solid transparent; border-right:5px solid transparent; border-top:6px solid rgba(71,85,105,0.8); pointer-events:none}
.energy-chart-card__controls .chart-select{appearance:none; border:1px solid var(--border); border-radius:999px; background:#fff; font-size:.78rem; font-weight:600; color:var(--ink); padding:6px 34px 6px 14px; line-height:1.2; cursor:pointer; box-shadow:0 1px 2px rgba(15,23,42,0.05); transition:border-color .18s ease, box-shadow .18s ease}
.energy-chart-card__controls .chart-select:focus-visible{outline:2px solid var(--ring); outline-offset:2px; border-color:transparent; box-shadow:0 0 0 3px rgba(39,125,161,0.15)}
.energy-chart-card__controls .chart-select:hover{border-color:rgba(39,125,161,0.45)}
.chart-card-title{font-size:1.05rem; letter-spacing:-0.01em}
.chart-card-subtitle{font-size:.85rem; color:#64748b; font-weight:600}
.energy-mix-card .chart-body,.energy-ranking-card .chart-body{display:flex; flex-direction:column; flex:1 1 auto; justify-content:center}
.energy-mix-content{display:flex; align-items:center; gap:18px; flex-wrap:wrap; height:100%}
.mix-variant{display:flex; align-items:center; gap:18px; flex-wrap:wrap; width:100%; height:100%; align-content:center}
.mix-variant--pie{display:grid; grid-template-columns:minmax(0, clamp(140px, 40%, 220px)) minmax(140px, 1fr); gap:20px; align-items:center; align-content:center; justify-items:start}
.mix-variant--donut{align-items:center}
.mix-variant--bars{flex-direction:column; align-items:stretch; gap:20px}
.mix-variant--rings{flex-direction:column; gap:20px}
.mix-variant--columns{flex-direction:column; align-items:stretch; gap:18px}
.mix-pie{--mix-chaleur:80%; --mix-elec:15%; --mix-froid:5%; position:relative; width:100%; max-width:clamp(140px, 42%, 220px); aspect-ratio:1 / 1; border-radius:50%; background:conic-gradient(var(--energy-chaleur) 0 var(--mix-chaleur), var(--energy-electricite) var(--mix-chaleur) calc(var(--mix-chaleur) + var(--mix-elec)), var(--energy-froid) calc(var(--mix-chaleur) + var(--mix-elec)) 100%); box-shadow:0 6px 18px rgba(15,23,42,0.08)}
.energy-mix-card--secondary .mix-pie{--mix-chaleur:70%; --mix-elec:20%; --mix-froid:10%}
.mix-pie::after{content:""; position:absolute; inset:18px; border-radius:50%; background:var(--card); box-shadow:inset 0 0 0 1px rgba(148,163,184,0.18)}
.mix-legend{list-style:none; margin:0; padding:0; display:grid; gap:10px; min-width:160px; align-self:stretch}
.mix-legend--compact{min-width:140px; gap:8px}
.mix-legend li{display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:8px; font-size:.9rem; color:#334155; font-variant-numeric:tabular-nums}
.mix-bullet{width:12px; height:12px; border-radius:999px; box-shadow:0 0 0 1px rgba(15,23,42,0.08)}
.mix-bullet.chaleur{background:var(--energy-chaleur)}
.mix-bullet.electricite{background:var(--energy-electricite)}
.mix-bullet.froid{background:var(--energy-froid)}
.mix-bullet.gaz{background:var(--c-orange-1)}
.mix-bullet.pac{background:var(--c-teal-muted)}
.mix-bullet.reseau{background:var(--c-red)}
.mix-bullet.biomasse{background:var(--c-green)}
.mix-bullet.chauffage{background:var(--c-orange-2)}
.mix-bullet.ecs{background:var(--c-yellow)}
.mix-bullet.ventilation{background:var(--c-blue-deep)}
.mix-bullet.scope1{background:var(--c-red)}
.mix-bullet.scope2{background:var(--c-blue-deep)}
.mix-bullet.combustibles{background:var(--c-orange-2)}
.mix-bullet.reseau-chaleur{background:var(--c-red)}
.mix-bullet.electricite-reseau{background:var(--energy-electricite)}
.mix-bullet.electricite-verte{background:var(--c-green)}
.mix-bullet.compression{background:var(--c-blue-soft)}
.mix-bullet.freecooling{background:var(--c-teal-muted)}
.mix-bullet.absorption{background:var(--c-blue-soft)}
.mix-bullet.autoprod{background:var(--c-yellow)}
.mix-bullet.verte{background:var(--c-green)}
.mix-bullet.confort{background:var(--c-blue-deep)}
.mix-bullet.eclairage{background:var(--c-orange-3)}
.mix-bullet.hvac{background:var(--c-blue-deep)}
.mix-bullet.it{background:var(--c-blue-soft)}
.mix-bullet.process{background:var(--c-red)}
.mix-bullet.services{background:#94a3b8}
.mix-bullet.reseau-eau{background:var(--c-blue-deep)}
.mix-bullet.nappe{background:var(--c-teal-muted)}
.mix-bullet.pluie{background:var(--c-teal)}
.mix-bullet.recyclee{background:var(--c-teal)}
.mix-bullet.sanitaires{background:var(--c-blue-deep)}
.mix-bullet.nettoyage{background:var(--c-teal-muted)}
.mix-bullet.irrigation{background:var(--c-green)}
.mix-bullet.pertes{background:var(--c-orange-1)}
.mix-label{font-weight:600}
.mix-value{font-weight:700; color:#0f172a}
.mix-donut{--mix-chaleur:80; --mix-elec:15; --mix-froid:5; position:relative; width:132px; height:132px; border-radius:50%; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; color:#0f172a; font-weight:700; background:conic-gradient(var(--energy-chaleur) 0 calc(var(--mix-chaleur) * 1%), var(--energy-electricite) calc(var(--mix-chaleur) * 1%) calc((var(--mix-chaleur) + var(--mix-elec)) * 1%), var(--energy-froid) calc((var(--mix-chaleur) + var(--mix-elec)) * 1%) 100%); box-shadow:0 8px 22px rgba(15,23,42,0.08)}
.mix-donut.heat{--mix-gaz:52; --mix-pac:20; --mix-reseau:18; --mix-biomasse:10; background:conic-gradient(var(--c-orange-1) 0 calc(var(--mix-gaz) * 1%), var(--c-teal-muted) calc(var(--mix-gaz) * 1%) calc((var(--mix-gaz) + var(--mix-pac)) * 1%), var(--c-red) calc((var(--mix-gaz) + var(--mix-pac)) * 1%) calc((var(--mix-gaz) + var(--mix-pac) + var(--mix-reseau)) * 1%), var(--c-green) calc((var(--mix-gaz) + var(--mix-pac) + var(--mix-reseau)) * 1%) 100%)}
.mix-donut.cold{--mix-compression:58; --mix-freecooling:22; --mix-reseau:12; --mix-absorption:8; background:conic-gradient(var(--c-blue-soft) 0 calc(var(--mix-compression) * 1%), var(--c-teal-muted) calc(var(--mix-compression) * 1%) calc((var(--mix-compression) + var(--mix-freecooling)) * 1%), var(--c-red) calc((var(--mix-compression) + var(--mix-freecooling)) * 1%) calc((var(--mix-compression) + var(--mix-freecooling) + var(--mix-reseau)) * 1%), var(--c-blue-soft) calc((var(--mix-compression) + var(--mix-freecooling) + var(--mix-reseau)) * 1%) 100%)}
.mix-donut.elec{--mix-reseau:68; --mix-autoprod:22; --mix-verte:10; background:conic-gradient(var(--c-blue-deep) 0 calc(var(--mix-reseau) * 1%), var(--c-yellow) calc(var(--mix-reseau) * 1%) calc((var(--mix-reseau) + var(--mix-autoprod)) * 1%), var(--c-green) calc((var(--mix-reseau) + var(--mix-autoprod)) * 1%) 100%)}
.mix-donut.water{--mix-reseau-eau:48; --mix-nappe:22; --mix-pluie:18; --mix-recyclee:12; background:conic-gradient(var(--c-blue-deep) 0 calc(var(--mix-reseau-eau) * 1%), var(--c-teal-muted) calc(var(--mix-reseau-eau) * 1%) calc((var(--mix-reseau-eau) + var(--mix-nappe)) * 1%), var(--c-teal) calc((var(--mix-reseau-eau) + var(--mix-nappe)) * 1%) calc((var(--mix-reseau-eau) + var(--mix-nappe) + var(--mix-pluie)) * 1%), var(--c-teal) calc((var(--mix-reseau-eau) + var(--mix-nappe) + var(--mix-pluie)) * 1%) 100%)}
.mix-donut.co2{--mix-scope1:64; --mix-scope2:36; background:conic-gradient(var(--c-red) 0 calc(var(--mix-scope1) * 1%), var(--c-blue-deep) calc(var(--mix-scope1) * 1%) 100%)}
.mix-donut::after{content:""; position:absolute; inset:24px; border-radius:inherit; background:var(--card); box-shadow:inset 0 0 0 1px rgba(148,163,184,0.16)}
.mix-donut__center,.mix-donut__label{position:relative; z-index:1}
.mix-donut__center{font-size:1.35rem; letter-spacing:-0.01em}
.mix-donut__label{font-size:.8rem; text-transform:uppercase; letter-spacing:.08em; color:#475569}
.mix-bars{display:flex; flex-direction:column; gap:14px}
.mix-bar{display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px; font-size:.9rem; color:#1f2937}
.mix-bar__track{position:relative; height:10px; border-radius:999px; background:#e2e8f0; overflow:hidden}
.mix-bar__fill{display:block; height:100%; border-radius:inherit; background:var(--mix-color); width:calc(var(--mix-value) * 1%); transition:width .24s ease}
.mix-bar__value{font-weight:700; color:#0f172a}
.mix-bar.chaleur{--mix-color:var(--energy-chaleur)}
.mix-bar.electricite{--mix-color:var(--energy-electricite)}
.mix-bar.froid{--mix-color:var(--energy-froid)}
.mix-bar.gaz{--mix-color:var(--c-orange-1)}
.mix-bar.pac{--mix-color:var(--c-teal-muted)}
.mix-bar.reseau{--mix-color:var(--c-red)}
.mix-bar.biomasse{--mix-color:var(--c-green)}
.mix-bar.chauffage{--mix-color:var(--c-orange-2)}
.mix-bar.ecs{--mix-color:var(--c-yellow)}
.mix-bar.ventilation{--mix-color:var(--c-blue-deep)}
.mix-bar.compression{--mix-color:var(--c-blue-soft)}
.mix-bar.freecooling{--mix-color:var(--c-teal-muted)}
.mix-bar.absorption{--mix-color:var(--c-blue-soft)}
.mix-bar.confort{--mix-color:var(--c-blue-deep)}
.mix-bar.process{--mix-color:var(--c-red)}
.mix-bar.it{--mix-color:var(--c-blue-soft)}
.mix-bar.autoprod{--mix-color:var(--c-yellow)}
.mix-bar.verte{--mix-color:var(--c-green)}
.mix-bar.scope1{--mix-color:var(--c-red)}
.mix-bar.scope2{--mix-color:var(--c-blue-deep)}
.mix-bar.combustibles{--mix-color:var(--c-orange-2)}
.mix-bar.reseau-chaleur{--mix-color:var(--c-red)}
.mix-bar.electricite-reseau{--mix-color:var(--energy-electricite)}
.mix-bar.electricite-verte{--mix-color:var(--c-green)}
.mix-bar.services{--mix-color:#94a3b8}
.mix-bar.reseau-eau{--mix-color:var(--c-blue-deep)}
.mix-bar.nappe{--mix-color:var(--c-teal-muted)}
.mix-bar.pluie{--mix-color:var(--c-teal)}
.mix-bar.recyclee{--mix-color:var(--c-teal)}
.mix-bar.sanitaires{--mix-color:var(--c-blue-deep)}
.mix-bar.nettoyage{--mix-color:var(--c-teal-muted)}
.mix-bar.irrigation{--mix-color:var(--c-green)}
.mix-bar.pertes{--mix-color:var(--c-orange-1)}
.mix-rings{display:flex; gap:18px; flex-wrap:wrap}
.mix-ring{--mix-color:var(--energy-chaleur); position:relative; width:96px; height:96px; border-radius:50%; background:conic-gradient(var(--mix-color) 0 calc(var(--mix-value) * 1%), rgba(226,232,240,0.7) calc(var(--mix-value) * 1%) 100%); display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(15,23,42,0.08)}
.mix-ring::after{content:""; position:absolute; inset:20px; border-radius:inherit; background:var(--card); box-shadow:inset 0 0 0 1px rgba(148,163,184,0.16)}
.mix-ring__inner{position:relative; z-index:1; display:flex; flex-direction:column; gap:2px; align-items:center; text-align:center}
.mix-ring__value{font-weight:700; font-size:1rem; color:#0f172a}
.mix-ring__label{font-size:.75rem; text-transform:uppercase; letter-spacing:.06em; color:#475569}
.mix-ring.electricite{--mix-color:var(--energy-electricite)}
.mix-ring.froid{--mix-color:var(--energy-froid)}
.mix-ring.pac{--mix-color:var(--c-teal-muted)}
.mix-ring.reseau{--mix-color:var(--c-red)}
.mix-ring.biomasse{--mix-color:var(--c-green)}
.mix-ring.chauffage{--mix-color:var(--c-orange-2)}
.mix-ring.ecs{--mix-color:var(--c-yellow)}
.mix-ring.ventilation{--mix-color:var(--c-blue-deep)}
.mix-ring.confort{--mix-color:var(--c-blue-deep)}
.mix-ring.process{--mix-color:var(--c-red)}
.mix-ring.it{--mix-color:var(--c-blue-soft)}
.mix-ring.eclairage{--mix-color:var(--c-orange-3)}
.mix-ring.hvac{--mix-color:var(--c-blue-deep)}
.mix-ring.services{--mix-color:#94a3b8}
.mix-ring.reseau-eau{--mix-color:var(--c-blue-deep)}
.mix-ring.nappe{--mix-color:var(--c-teal-muted)}
.mix-ring.pluie{--mix-color:var(--c-teal)}
.mix-ring.recyclee{--mix-color:var(--c-teal)}
.mix-ring.sanitaires{--mix-color:var(--c-blue-deep)}
.mix-ring.nettoyage{--mix-color:var(--c-teal-muted)}
.mix-ring.irrigation{--mix-color:var(--c-green)}
.mix-ring.pertes{--mix-color:var(--c-orange-1)}
.mix-columns{display:flex; gap:18px; align-items:flex-end; justify-content:flex-start; height:128px; padding:0 4px}
.mix-column{flex:1; min-width:18px; border-radius:10px 10px 4px 4px; background:linear-gradient(180deg, rgba(39,125,161,0.25), rgba(39,125,161,0)); position:relative; height:100%}
.mix-column::before{content:""; position:absolute; left:0; right:0; bottom:0; border-radius:inherit; background:var(--mix-color); opacity:.85; height:calc(var(--mix-value) * 1%)}
.mix-column.chaleur{--mix-color:var(--energy-chaleur)}
.mix-column.electricite{--mix-color:var(--energy-electricite)}
.mix-column.froid{--mix-color:var(--energy-froid)}
.mix-columns-legend{list-style:none; margin:0; padding:0; display:grid; gap:8px; font-size:.85rem; color:#475569}
.mix-columns-legend li{display:flex; justify-content:space-between; font-variant-numeric:tabular-nums}
.energy-ranking-header{display:flex; justify-content:space-between; align-items:flex-start; gap:12px}
.energy-ranking-header__titles{display:flex; flex-direction:column; gap:4px}
.ranking-title{font-size:1.05rem; letter-spacing:-0.01em; font-weight:700; color:#1f2937}
.ranking-subtitle{font-size:.85rem; color:#64748b; font-weight:600}
.ranking-subtitle [data-ranking-unit]{color:var(--section-color, var(--c-blue-deep))}
.energy-ranking{display:flex; flex-direction:column; gap:16px}
.ranking-list{list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:12px}
.ranking-item{display:grid; grid-template-columns:auto minmax(0, 1fr) auto; align-items:center; gap:14px}
.ranking-item--empty{grid-column:1 / -1; justify-content:center; text-align:center; font-size:.88rem; color:#94a3b8; padding:10px 0}
.ranking-rank{display:inline-flex; align-items:center; justify-content:center; font-weight:700; color:#1e293b; background:rgba(39,125,161,0.2); border-radius:999px; min-width:28px; padding:4px 10px; font-size:.85rem}
.ranking-main{display:flex; flex-direction:column; gap:8px; width:100%}
.ranking-name{font-weight:600; color:#0f172a; letter-spacing:-0.01em}
.ranking-name--link{cursor:pointer; background:none; border:none; padding:0; font:inherit; color:inherit; text-align:left}
.ranking-name--link:focus-visible{outline:2px solid var(--ring, rgba(39,125,161,0.45)); outline-offset:2px; border-radius:4px}
.ranking-bar{position:relative; background:rgba(148,163,184,0.26); border-radius:999px; height:8px; overflow:hidden}
.ranking-bar__fill{height:100%; background:var(--section-color, var(--c-blue-deep)); border-radius:inherit; width:0; transition:width .28s ease}
.ranking-value{font-variant-numeric:tabular-nums; font-weight:700; color:#0f172a; white-space:nowrap; font-size:.92rem}
.energy-mix-card figcaption,.energy-ranking-card figcaption{margin:0; font-size:.78rem; color:#64748b}
.energy-chart-stack .energy-trend-chart{grid-column:1 / -1; margin-top:0}

.energy-chart-stack .energy-trend-chart .chart-title{padding-right:64px}

[data-chart-slot]{
  position:relative;
  outline:none;
}

[data-chart-slot].is-chart-selected{
  box-shadow:0 0 0 3px rgba(39,125,161,0.25);
  border-radius:inherit;
}

[data-chart-slot]:focus-visible{
  outline:3px solid var(--ring);
  outline-offset:2px;
}

.chart-delete-btn{
  position:absolute;
  bottom:16px;
  right:16px;
  top:auto;
  width:38px;
  height:38px;
  border-radius:50%;
  border:1px solid var(--border, rgba(148,163,184,0.35));
  background:rgba(255,255,255,0.94);
  color:var(--c-red);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:12;
  box-shadow:0 12px 28px rgba(15,23,42,0.14);
  opacity:0;
  transform:scale(.9);
  transition:opacity .18s ease, transform .18s ease, box-shadow .18s ease, color .18s ease;
}

[data-chart-slot]:hover .chart-delete-btn,
[data-chart-slot]:focus-within .chart-delete-btn{
  opacity:1;
  transform:scale(1);
}

.chart-delete-btn:hover{
  color:var(--c-red);
  box-shadow:0 18px 36px rgba(239,68,68,0.18);
}

.chart-delete-btn:focus-visible{
  outline:none;
  box-shadow:0 0 0 4px var(--ring);
  opacity:1;
  transform:scale(1);
}

.chart-tile-handle{
  position:absolute;
  top:14px;
  right:14px;
  width:38px;
  height:38px;
  border-radius:12px;
  border:1px solid var(--border, rgba(148,163,184,0.35));
  background:rgba(248,250,252,0.95);
  color:#1f2937;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
  z-index:13;
  box-shadow:0 12px 28px rgba(15,23,42,0.14);
  opacity:0;
  transform:scale(.92);
  transition:opacity .18s ease, box-shadow .18s ease, color .18s ease, border-color .18s ease, transform .18s ease;
  touch-action:none;
}

.chart-tile-handle:hover{
  color:#0f172a;
  border-color:rgba(148,163,184,0.6);
  box-shadow:0 16px 32px rgba(15,23,42,0.18);
  opacity:1;
  transform:scale(1);
}

.chart-tile-handle:active,
.chart-tile-handle.is-dragging{
  cursor:grabbing;
  transform:scale(.98);
  box-shadow:0 16px 32px rgba(15,23,42,0.18);
}

.chart-tile-handle:focus-visible{
  outline:none;
  opacity:1;
  box-shadow:0 0 0 4px var(--ring), 0 16px 32px rgba(15,23,42,0.18);
  transform:scale(1);
}

.has-chart-tile-handle:hover .chart-tile-handle,
.has-chart-tile-handle:focus-within .chart-tile-handle,
.chart-tile-handle.is-dragging{
  opacity:1;
  transform:scale(1);
}

.chart-tile-handle__icon{
  display:grid;
  grid-template-columns:repeat(3, minmax(0,1fr));
  grid-auto-rows:minmax(0,1fr);
  gap:2px 3px;
  width:14px;
  height:12px;
}

.chart-tile-handle__dot{
  width:4px;
  height:4px;
  border-radius:999px;
  background:currentColor;
}

.chart-tile-placeholder{
  border:2px dashed rgba(148,163,184,0.6);
  border-radius:16px;
  background:rgba(148,163,184,0.12);
  transition:height .16s ease, width .16s ease;
  pointer-events:none;
}

.chart-catalog-drop-placeholder{
  border-color:rgba(147,197,253,0.65);
  background:rgba(191,219,254,0.18);
  box-shadow:inset 0 0 0 1px rgba(147,197,253,0.25);
}

.chart-catalog-drop-placeholder.is-drop-target-placeholder{
  border-color:rgba(39,125,161,0.9);
  background:rgba(191,219,254,0.32);
  box-shadow:0 0 0 4px rgba(39,125,161,0.22), inset 0 0 0 1px rgba(39,125,161,0.4);
}

.chart-catalog-drop-placeholder[data-drop-position="before"]{
  margin-bottom:0;
}

.chart-catalog-drop-placeholder[data-drop-position="after"]{
  margin-top:0;
}

[data-chart-slot].is-dragging{
  box-shadow:0 22px 44px rgba(15,23,42,0.22);
  cursor:grabbing;
}

body.chart-tiles-dragging{user-select:none; cursor:grabbing; touch-action:none; overscroll-behavior:contain;}

@media (max-width: 640px){
  .chart-tile-handle{
    top:12px;
    right:12px;
    width:36px;
    height:36px;
    border-radius:10px;
  }
}

.chart-catalog-trigger{
  position:sticky;
  bottom:24px;
  align-self:flex-end;
  display:inline-flex;
  align-items:center;
  gap:12px;
  padding:12px 20px;
  border-radius:999px;
  border:1px solid rgba(148,163,184,0.32);
  background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(241,245,249,0.9));
  color:var(--c-blue-deep);
  font-weight:600;
  cursor:pointer;
  box-shadow:0 14px 28px rgba(39,125,161,0.18);
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, color .18s ease, background .18s ease;
  z-index:16;
}

.chart-catalog-trigger__icon svg{display:block}

.chart-catalog-trigger:hover{
  transform:translateY(-2px);
  box-shadow:0 20px 40px rgba(39,125,161,0.24);
  border-color:rgba(39,125,161,0.45);
}

.chart-catalog-trigger:focus-visible{
  outline:none;
  box-shadow:0 0 0 4px var(--ring);
}

.chart-catalog-trigger.is-in-catalog{
  color:#0f172a;
  border-color:rgba(96,165,250,0.6);
  background:linear-gradient(135deg, rgba(219,234,254,0.95), rgba(191,219,254,0.85));
  box-shadow:0 16px 32px rgba(39,125,161,0.24);
}

.energy-chart-zone.catalog-open .chart-catalog-trigger{z-index:18}

.energy-typology-header,
.energy-map-header,
.energy-monthly-header,
.energy-distribution-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:14px;
  font-weight:700;
  color:#1f2937;
  padding-right:56px;
}
.energy-typology-header__titles,
.energy-map-header__titles,
.energy-monthly-header__titles,
.energy-distribution-header__titles{display:flex; flex-direction:column; gap:4px}
.typology-title,.map-title,.monthly-title,.distribution-title{font-size:1.05rem; letter-spacing:-0.01em}
.typology-subtitle,.map-subtitle,.monthly-subtitle,.distribution-subtitle{font-size:.85rem; color:#64748b; font-weight:600}

.energy-typology-card .chart-body,
.energy-map-card .chart-body,
.energy-monthly-card .chart-body,
.energy-distribution-card .chart-body{display:flex; flex-direction:column; gap:18px}

.typology-chart{display:grid; gap:18px; align-content:start}
.typology-chart--rows{gap:20px}
.typology-treemap{position:relative; width:100%; min-height:220px; border-radius:20px; background:linear-gradient(140deg, rgba(226,232,240,0.55), rgba(248,250,252,0.8)); border:1px solid rgba(148,163,184,0.35); overflow:hidden; isolation:isolate}
.typology-chart--rows .typology-treemap{min-height:240px}
.typology-treemap::before{content:""; position:absolute; inset:0; background-image:linear-gradient(to right, rgba(148,163,184,0.12) 1px, transparent 1px), linear-gradient(to bottom, rgba(148,163,184,0.12) 1px, transparent 1px); background-size:42px 42px; opacity:0.32; pointer-events:none}
.typology-treemap .chart-empty{position:absolute; inset:0; margin:0; display:flex; align-items:center; justify-content:center; text-align:center; padding:0 24px; font-size:.92rem; color:#475569}
.typology-bars{display:flex; align-items:flex-end; gap:18px; padding:18px 20px 22px; border-radius:20px; background:linear-gradient(140deg, rgba(226,232,240,0.55), rgba(248,250,252,0.9)); border:1px solid rgba(148,163,184,0.35); min-height:240px; box-sizing:border-box; overflow-x:auto; scrollbar-width:thin; -webkit-overflow-scrolling:touch}
.typology-chart--rows .typology-bars{min-height:260px}
.typology-bars .chart-empty{margin:0; display:flex; align-items:center; justify-content:center; text-align:center; padding:0 24px; font-size:.92rem; color:#475569; min-height:100%; width:100%}
.typology-bar{display:grid; grid-template-rows:auto 1fr auto auto; gap:12px; border-radius:14px; padding:0 8px; position:relative; font-variant-numeric:tabular-nums; min-width:120px; align-items:end; justify-items:center; text-align:center}
.typology-bar__value{font-weight:700; font-size:1.02rem; color:#0f172a}
.typology-bar__column{display:flex; align-items:flex-end; justify-content:center; width:100%; min-height:160px}
.typology-bar__column-track{position:relative; width:70%; max-width:82px; height:160px; border-radius:18px; background:rgba(148,163,184,0.22); overflow:hidden; display:flex; align-items:flex-end}
.typology-bar__column-fill{width:100%; height:calc(var(--bar-fill,0) * 1%); border-radius:18px; background:linear-gradient(180deg, var(--bar-color-soft, rgba(39,125,161,0.2)), var(--bar-color-strong, var(--c-blue-deep))); box-shadow:0 8px 18px rgba(15,23,42,0.18); transition:height .32s cubic-bezier(.33,1,.68,1); transform-origin:bottom}
.typology-bar__label{font-weight:600; color:#0f172a; font-size:.94rem; line-height:1.3; min-height:3.4em; display:flex; align-items:center; justify-content:center; text-align:center}
.typology-bar__footer{display:flex; flex-direction:column; align-items:center; gap:6px; font-size:.8rem; color:#334155; font-weight:600; min-height:2.6em; justify-content:center}
.typology-bar__share{background:rgba(255,255,255,0.82); border-radius:999px; padding:4px 10px; color:var(--bar-color-strong, var(--c-blue-deep)); box-shadow:inset 0 0 0 1px rgba(255,255,255,0.5)}
.typology-bar__count{color:#475569}
.typology-node{position:absolute; left:calc(var(--x,0) * 100%); top:calc(var(--y,0) * 100%); width:calc(var(--w,1) * 100%); height:calc(var(--h,1) * 100%); padding:16px 18px; border-radius:0; box-sizing:border-box; background:linear-gradient(155deg, var(--treemap-color-strong, var(--c-blue-deep)), var(--treemap-color-soft, rgba(39,125,161,0.18))); border:1px solid var(--treemap-color-outline, rgba(39,125,161,0.32)); box-shadow:inset 0 0 0 1px rgba(255,255,255,0.35); display:flex; flex-direction:column; justify-content:space-between; gap:12px; color:#0f172a; font-variant-numeric:tabular-nums; overflow:hidden; transition:transform .18s ease, box-shadow .18s ease}
.typology-node[data-typology-node],
.typology-bar[data-typology-node]{cursor:pointer}
.typology-node[data-typology-node]:focus-visible,
.typology-bar[data-typology-node]:focus-visible{outline:3px solid rgba(15,23,42,0.45); outline-offset:3px}
.typology-node.is-selected{transform:translateY(-4px); box-shadow:0 24px 44px rgba(15,23,42,0.26), 0 0 0 3px rgba(15,23,42,0.18), inset 0 0 0 1px rgba(255,255,255,0.5)}
.typology-node.is-selected:hover{transform:translateY(-4px)}
.typology-bar.is-selected{box-shadow:0 16px 34px rgba(15,23,42,0.22), 0 0 0 3px rgba(15,23,42,0.18)}
.typology-node:hover{transform:translateY(-2px); box-shadow:0 16px 32px rgba(15,23,42,0.18)}
.typology-node__header{display:flex; align-items:flex-start; justify-content:space-between; gap:12px}
.typology-node__label{font-weight:600; font-size:.94rem; color:#0f172a; line-height:1.25}
.typology-node__share{font-size:.78rem; font-weight:600; color:var(--treemap-color-strong, var(--c-blue-deep)); background:rgba(255,255,255,0.6); border-radius:999px; padding:3px 9px; white-space:nowrap; box-shadow:inset 0 0 0 1px rgba(255,255,255,0.35)}
.typology-node__footer{display:flex; align-items:flex-end; justify-content:space-between; gap:10px}
.typology-node__value{font-weight:700; font-size:1.08rem}
.typology-node__count{font-size:.8rem; color:#334155; font-weight:600}
.typology-node.is-compact{padding:12px 14px; gap:10px}
.typology-node.is-compact .typology-node__label{font-size:.85rem}
.typology-node.is-compact .typology-node__value{font-size:.94rem}
.typology-node.is-tight .typology-node__count{display:none}
.typology-node.is-tight .typology-node__share{font-size:.72rem}
.typology-node.is-mini{padding:10px; gap:8px}
.typology-node.is-mini .typology-node__label{font-size:.78rem}
.typology-node.is-mini .typology-node__value{font-size:.86rem}
.typology-node.is-mini .typology-node__share{display:none}
.typology-node.is-micro{padding:8px 9px; gap:6px}
.typology-node.is-micro .typology-node__header{flex-direction:column; align-items:flex-start; gap:4px}
.typology-node.is-micro .typology-node__share{display:none}
.typology-node.is-micro .typology-node__label{font-size:.74rem}
.typology-node.is-micro .typology-node__value{font-size:.78rem}
.typology-node.is-micro .typology-node__count{display:none}
.typology-summary{margin:0; font-size:.88rem; color:#475569; text-align:left}
.typology-table{width:100%; border-collapse:collapse; font-size:.85rem; color:#334155; box-shadow:0 1px 0 rgba(148,163,184,0.18)}
.typology-table th,
.typology-table td{padding:10px 12px; text-align:left; border-bottom:1px solid rgba(148,163,184,0.28)}
.typology-table tbody tr:nth-child(even){background:rgba(226,232,240,0.3)}

.energy-map{display:flex; gap:18px; align-items:stretch}
.energy-map--grid{align-items:flex-start}
.map-canvas{position:relative; flex:1 1 auto; min-height:260px; border-radius:18px; background:rgba(39,125,161,0.15); border:1px solid rgba(148,163,184,0.45); box-shadow:inset 0 1px 4px rgba(15,23,42,0.08); overflow:hidden}
.map-canvas--grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(72px, 1fr)); gap:12px; padding:18px}
.map-canvas--grid .map-markers{position:static; display:contents; pointer-events:auto}
.map-viewport{position:absolute; inset:0; border-radius:inherit; overflow:hidden; background:rgba(39,125,161,0.12)}
.map-canvas .leaflet-container{width:100%; height:100%; border-radius:inherit; font-family:inherit; background:rgba(39,125,161,0.18)}
.leaflet-control-attribution{background:rgba(255,255,255,0.85); border-radius:10px; padding:4px 8px; margin:0 8px 8px}
.leaflet-div-icon{background:transparent; border:none}
.leaflet-tooltip{background:rgba(15,23,42,0.85); color:#f8fafc; border:none; border-radius:8px; padding:6px 10px; box-shadow:0 12px 22px rgba(15,23,42,0.28); font-size:.75rem; font-weight:600}
.leaflet-tooltip-top:before{border-top-color:rgba(15,23,42,0.85)}
.map-markers{position:absolute; inset:0; margin:0; padding:0; list-style:none; pointer-events:none}
.map-marker{position:absolute; transform:translate(-50%, -50%); display:flex; align-items:center; gap:8px; font-size:.82rem; font-weight:600; color:#0f172a; pointer-events:auto; transition:transform .18s ease, filter .18s ease}
.map-marker:hover{transform:translate(-50%, -52%); filter:drop-shadow(0 10px 16px rgba(15,23,42,0.22))}
.map-marker__dot{width:var(--marker-size,16px); height:var(--marker-size,16px); border-radius:999px; box-shadow:0 0 0 2px #fff, 0 6px 14px rgba(15,23,42,0.22)}
.map-marker__label{padding:6px 10px; border-radius:999px; background:rgba(255,255,255,0.92); border:1px solid rgba(148,163,184,0.4); box-shadow:0 8px 18px rgba(15,23,42,0.12)}
.map-marker--low .map-marker__dot{background:var(--c-green)}
.map-marker--medium .map-marker__dot{background:var(--c-blue-deep)}
.map-marker--high .map-marker__dot{background:var(--c-orange-1)}
.map-marker--critical .map-marker__dot{background:var(--c-red)}
.map-marker[data-size="xs"] .map-marker__dot{width:10px; height:10px}
.map-marker[data-size="sm"] .map-marker__dot{width:12px; height:12px}
.map-marker[data-size="lg"] .map-marker__dot{width:20px; height:20px}
.map-marker[data-size="xl"] .map-marker__dot{width:24px; height:24px}
.map-marker[data-size="xs"] .map-marker__label{font-size:.75rem}
.map-marker[data-size="xl"] .map-marker__label{font-size:.88rem}
.map-controls{position:absolute; inset:auto 12px 12px auto; display:flex; flex-direction:column; gap:6px; z-index:5}
.map-controls__btn{width:34px; height:34px; border-radius:10px; border:1px solid rgba(15,23,42,0.15); background:rgba(255,255,255,0.92); color:#0f172a; font-size:1.1rem; font-weight:600; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 6px 18px rgba(15,23,42,0.12); transition:background .18s ease, transform .18s ease}
.map-controls__btn:focus-visible{outline:2px solid var(--c-blue-deep); outline-offset:2px}
.map-controls__btn:hover{background:#e2e8f0; transform:translateY(-1px)}
.map-controls__btn:active{transform:translateY(0)}
.map-legend-wrapper{min-width:160px; display:flex; flex-direction:column; gap:12px; padding:6px 0}
.map-legend-title{font-size:.82rem; text-transform:uppercase; letter-spacing:.08em; color:#64748b}
.map-legend{list-style:none; margin:0; padding:0; display:grid; gap:10px; font-size:.85rem; color:#334155}
.map-legend li{display:flex; align-items:center; gap:8px}
.map-legend__dot{width:12px; height:12px; border-radius:999px; box-shadow:0 0 0 1px rgba(15,23,42,0.12)}
.map-legend__dot--low{background:var(--c-green)}
.map-legend__dot--medium{background:var(--c-blue-deep)}
.map-legend__dot--high{background:var(--c-orange-1)}
.map-legend__dot--critical{background:var(--c-red)}
.map-empty{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; text-align:center; font-size:.9rem; color:#94a3b8}

.monthly-chart{display:grid; gap:18px; align-content:start}
.monthly-chart__viewport{position:relative; width:100%; min-height:220px}
.monthly-bars{
  --monthly-scale:0.8px;
  position:relative;
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:14px;
  min-height:200px;
  width:100%;
  min-width:0;
}
.monthly-bars[data-density="compact"]{gap:10px}
.monthly-bars[data-density="ultra"]{gap:2px}
.monthly-bar{position:relative; flex:1 1 0; display:flex; flex-direction:column; align-items:center; gap:12px; font-variant-numeric:tabular-nums; color:#0f172a; cursor:default; outline:none; min-width:40px}
.monthly-bars[data-density="compact"] .monthly-bar{min-width:22px}
.monthly-bars[data-density="ultra"] .monthly-bar{min-width:12px}
.monthly-bar:focus-visible{outline:none}
.monthly-stack-wrap{position:relative; width:100%; display:flex; justify-content:center; align-items:flex-end}
.monthly-stack{position:relative; width:100%; display:grid; gap:2px; border-radius:12px 12px 8px 8px; overflow:hidden; background:#e2e8f0; transition:transform .18s ease, box-shadow .18s ease; will-change:transform}
.monthly-bar:hover .monthly-stack,
.monthly-bar:focus-visible .monthly-stack,
.monthly-bar.is-tooltip-active .monthly-stack{transform:translateY(-6px); box-shadow:0 16px 32px rgba(15,23,42,0.18)}
.monthly-bar:focus-visible .monthly-stack{box-shadow:0 0 0 4px var(--ring, rgba(39,125,161,0.28)), 0 18px 36px rgba(15,23,42,0.22)}
.monthly-segment{width:100%; display:block; height:calc(var(--value,0) * var(--monthly-scale)); transition:height .24s ease}
.monthly-label{font-size:.78rem; font-weight:600; color:#475569; letter-spacing:.02em; text-transform:uppercase; text-align:center}
.monthly-bars[data-density="compact"] .monthly-label{font-size:.72rem}
.monthly-bars[data-density="ultra"] .monthly-label{font-size:.68rem; letter-spacing:.01em}
.monthly-segment--chaleur{background:linear-gradient(180deg, var(--energy-chaleur), var(--energy-chaleur-soft))}
.monthly-segment--electricite{background:linear-gradient(180deg, var(--energy-electricite), var(--energy-electricite-soft))}
.monthly-segment--froid{background:linear-gradient(180deg, var(--energy-froid-soft), var(--energy-froid))}
.monthly-segment--scope1{background:linear-gradient(180deg, var(--c-red), var(--c-orange-3))}
.monthly-segment--scope2{background:linear-gradient(180deg, var(--c-blue-deep), var(--c-teal-muted))}
.monthly-segment--eau{background:linear-gradient(180deg, var(--c-teal-muted), var(--c-blue-deep))}
.monthly-line{position:absolute; inset:0; width:100%; height:100%; stroke:#1e293b; fill:none; pointer-events:none}
.monthly-line polyline{fill:none; stroke:#1f2937; stroke-width:2.4; stroke-linecap:round; stroke-linejoin:round; opacity:.65}
.monthly-tooltips{position:absolute; inset:0; pointer-events:none; z-index:10}
.monthly-tooltip{position:absolute; left:var(--tooltip-left, 50%); bottom:calc(var(--tooltip-bottom, 0px) + 22px); transform:translate(-50%, 12px); opacity:0; pointer-events:none; transition:opacity .18s ease, transform .18s ease; display:flex; flex-direction:column; align-items:center; gap:12px; min-width:200px; max-width:260px; text-align:center}
.monthly-tooltip[data-visible="true"]{opacity:1; transform:translate(-50%, 0)}
.monthly-tooltip__value{
  background:#fff;
  color:#0f172a;
  font-size:.72rem;
  font-weight:600;
  padding:4px 10px;
  border-radius:6px;
  box-shadow:0 8px 18px rgba(15,23,42,0.18);
  white-space:nowrap;
  text-align:center;
}
.monthly-tooltip__body{position:relative; background:rgba(15,23,42,0.92); color:#e2e8f0; padding:16px 18px; border-radius:16px; box-shadow:0 20px 44px rgba(15,23,42,0.38); width:100%; display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center}
.monthly-tooltip__body::after{content:""; position:absolute; left:50%; bottom:-10px; transform:translateX(-50%); width:0; height:0; border-left:10px solid transparent; border-right:10px solid transparent; border-top:10px solid rgba(15,23,42,0.92)}
.monthly-tooltip__breakdown{margin:0; padding:0; list-style:none; display:flex; flex-direction:column; gap:6px; width:100%; text-align:left}
.monthly-tooltip__breakdown li{display:flex; align-items:flex-start; gap:10px; font-size:.78rem; line-height:1.4; color:#e2e8f0}
.monthly-tooltip__dot{width:10px; height:10px; border-radius:999px; flex:0 0 10px; margin-top:4px; box-shadow:0 0 0 2px rgba(255,255,255,0.18)}
.monthly-tooltip__dot--chaleur{background:linear-gradient(180deg, var(--energy-chaleur), var(--energy-chaleur-soft))}
.monthly-tooltip__dot--electricite{background:linear-gradient(180deg, var(--energy-electricite), var(--energy-electricite-soft))}
.monthly-tooltip__dot--froid{background:linear-gradient(180deg, var(--energy-froid-soft), var(--energy-froid))}
.monthly-tooltip__dot--scope1{background:linear-gradient(180deg, var(--c-red), var(--c-orange-3))}
.monthly-tooltip__dot--scope2{background:linear-gradient(180deg, var(--c-blue-deep), var(--c-teal-muted))}
.monthly-tooltip__dot--co2{background:linear-gradient(180deg, var(--c-red), var(--c-orange-3))}
.monthly-tooltip__dot--eau{background:linear-gradient(180deg, var(--c-teal-muted), var(--c-blue-deep))}
.monthly-tooltip__entry-text{flex:1; display:block; font-variant-numeric:tabular-nums}
.monthly-chart--lines .monthly-stack{background:transparent}
.monthly-chart--lines .monthly-stack::before{content:""; position:absolute; inset:0; border-radius:inherit; background:linear-gradient(180deg, rgba(148,163,184,0.18), rgba(148,163,184,0.02)); pointer-events:none}
.monthly-chart--lines .monthly-segment{opacity:.45}
.monthly-legend{display:flex; flex-wrap:wrap; gap:12px 16px; align-items:center; font-size:.85rem; color:#475569}
.monthly-legend--compact{gap:10px 14px}
.legend-dot{display:inline-flex; width:12px; height:12px; border-radius:999px; margin-right:6px; box-shadow:0 0 0 1px rgba(15,23,42,0.12)}
.legend-dot.chaleur{background:var(--energy-chaleur)}
.legend-dot.elec,.legend-dot.electricite{background:var(--energy-electricite)}
.legend-dot.froid{background:var(--energy-froid)}
.legend-dot.scope1{background:var(--c-red)}
.legend-dot.scope2{background:var(--c-blue-deep)}
.legend-line-wrap{display:inline-flex; align-items:center; gap:6px}
.legend-line{display:inline-block; width:32px; height:2px; background:linear-gradient(90deg, rgba(15,23,42,0.1), rgba(15,23,42,0.7)); border-radius:999px}
.monthly-chart--heat .monthly-stack{background:linear-gradient(180deg, color-mix(in srgb, var(--energy-chaleur) 22%, transparent), color-mix(in srgb, var(--energy-chaleur) 6%, transparent))}
.monthly-chart--heat .monthly-line polyline{stroke:var(--energy-chaleur)}
.monthly-chart--heat .legend-line{background:linear-gradient(90deg, color-mix(in srgb, var(--energy-chaleur) 24%, transparent), color-mix(in srgb, var(--energy-chaleur) 70%, transparent))}
.monthly-chart--cold .monthly-stack{background:linear-gradient(180deg, color-mix(in srgb, var(--energy-froid) 20%, transparent), color-mix(in srgb, var(--energy-froid) 6%, transparent))}
.monthly-chart--cold .monthly-line polyline{stroke:var(--energy-froid)}
.monthly-chart--cold .legend-line{background:linear-gradient(90deg, color-mix(in srgb, var(--energy-froid) 24%, transparent), color-mix(in srgb, var(--energy-froid) 68%, transparent))}
.monthly-chart--elec .monthly-stack{background:linear-gradient(180deg, color-mix(in srgb, var(--energy-electricite) 24%, transparent), color-mix(in srgb, var(--energy-electricite) 8%, transparent))}
.monthly-chart--elec .monthly-line polyline{stroke:var(--energy-electricite)}
.monthly-chart--elec .legend-line{background:linear-gradient(90deg, color-mix(in srgb, var(--energy-electricite) 26%, transparent), color-mix(in srgb, var(--energy-electricite) 72%, transparent))}
.monthly-chart--co2 .monthly-stack{background:linear-gradient(180deg, rgba(249,65,68,0.18), rgba(39,125,161,0.04))}
.monthly-chart--co2 .monthly-line polyline{stroke:var(--c-red)}
.monthly-chart--co2 .legend-line{background:linear-gradient(90deg, rgba(67,170,139,0.2), rgba(251,113,133,0.85))}
.monthly-chart--water .monthly-stack{background:linear-gradient(180deg, rgba(67,170,139,0.18), rgba(39,125,161,0.04))}
.monthly-chart--water .monthly-line polyline{stroke:var(--c-teal-muted)}
.monthly-chart--water .legend-line{background:linear-gradient(90deg, rgba(67,170,139,0.2), rgba(39,125,161,0.85))}
.energy-monthly--lines{position:relative; display:flex; flex-direction:column; gap:18px}
.energy-monthly--lines .monthly-bars{position:relative; z-index:1}
.energy-monthly--lines .monthly-line{position:absolute; left:0; right:0; top:0; bottom:48px; z-index:2}
.energy-monthly--lines .monthly-summary{position:relative; z-index:3}
.monthly-summary{margin:0; font-size:.88rem; color:#475569}

.distribution-chart{display:grid; gap:18px; align-content:start}
.distribution-graph{position:relative; min-height:220px}
.distribution-bars{
  --distribution-scale:1px;
  display:grid;
  grid-auto-flow:column;
  align-items:end;
  gap:10px;
  height:100%;
  min-height:200px;
}
.distribution-bar{display:flex; flex-direction:column; gap:8px; align-items:center; font-variant-numeric:tabular-nums; color:#0f172a}
.distribution-bar__fill{width:100%; min-width:12px; border-radius:8px 8px 4px 4px; background:linear-gradient(180deg, rgba(39,125,161,0.18), rgba(39,125,161,0.82)); height:calc(var(--value,0) * var(--distribution-scale)); box-shadow:0 10px 18px rgba(39,125,161,0.22)}
.distribution-chart--line .distribution-bar__fill{background:rgba(148,163,184,0.26)}
.distribution-bar__label{font-size:.8rem; color:#475569}
.distribution-bar__value{font-weight:700; font-size:.9rem}
.distribution-line{position:absolute; inset:0; width:100%; height:100%; pointer-events:none}
.distribution-line polyline{fill:none; stroke:var(--energy-chaleur); stroke-width:2.6; stroke-linecap:round; stroke-linejoin:round; filter:drop-shadow(0 10px 16px color-mix(in srgb, var(--energy-chaleur) 32%, transparent))}
.distribution-legend{display:flex; flex-wrap:wrap; gap:12px 20px; font-size:.85rem; color:#475569}
.distribution-legend .legend-bar{display:inline-flex; width:14px; height:14px; border-radius:4px; background:linear-gradient(180deg, rgba(39,125,161,0.18), rgba(39,125,161,0.82)); box-shadow:0 4px 10px rgba(39,125,161,0.18); margin-right:6px}
.distribution-chart--line .distribution-legend .legend-bar{background:rgba(148,163,184,0.26); box-shadow:none}
.distribution-legend .legend-line{display:inline-flex; width:32px; height:3px; background:var(--energy-chaleur); border-radius:999px; margin-right:6px; box-shadow:0 4px 10px color-mix(in srgb, var(--energy-chaleur) 32%, transparent)}

.preview-typology{position:relative; display:block; width:100%; height:36px}
.preview-typology span{position:absolute; border-radius:0; box-shadow:0 6px 12px rgba(39,125,161,0.18)}
.preview-typology--treemap span:nth-child(1){left:0; top:0; width:56%; height:100%; background:linear-gradient(150deg, rgba(39,125,161,0.85), rgba(39,125,161,0.55))}
.preview-typology--treemap span:nth-child(2){right:0; top:0; width:42%; height:58%; background:linear-gradient(150deg, rgba(67,170,139,0.82), rgba(39,125,161,0.74))}
.preview-typology--treemap span:nth-child(3){right:0; bottom:0; width:42%; height:36%; background:linear-gradient(150deg, rgba(39,125,161,0.8), rgba(87,117,144,0.62))}
.preview-pareto{position:relative; display:block; width:100%; height:36px; color:var(--c-blue-deep)}
.preview-pareto__bars{position:absolute; inset:2px 0 8px; display:grid; grid-auto-flow:column; grid-auto-columns:minmax(6px,1fr); align-items:flex-end; gap:4px}
.preview-pareto__bars span{display:block; height:calc(var(--h,60) * 1%); border-radius:6px 6px 4px 4px; background:linear-gradient(180deg, rgba(255,255,255,0.32), rgba(255,255,255,0)) , currentColor; box-shadow:0 4px 8px rgba(15,23,42,0.08)}
.preview-pareto__line{position:absolute; inset:0 0 6px; display:block; background:linear-gradient(135deg, transparent 35%, currentColor 35%, currentColor 65%, transparent 65%); opacity:.55; clip-path:polygon(0 100%, 16% 78%, 36% 58%, 62% 36%, 100% 8%, 100% 100%); border-radius:6px}
[data-chart-scope="chaleur"] .preview-pareto{color:var(--energy-chaleur)}
[data-chart-scope="froid"] .preview-pareto{color:var(--energy-froid)}
[data-chart-scope="elec"] .preview-pareto{color:var(--energy-electricite)}
[data-chart-scope="co2"] .preview-pareto{color:var(--c-green)}
[data-chart-scope="eau"] .preview-pareto{color:var(--c-teal-muted)}
.preview-ranking{display:flex; flex-direction:column; gap:4px; width:64px; padding:6px 0}
.preview-ranking span{height:6px; border-radius:999px; background:linear-gradient(90deg, rgba(39,125,161,0.25), rgba(39,125,161,0.8))}
.preview-ranking span:nth-child(1){background:linear-gradient(90deg, color-mix(in srgb, var(--energy-chaleur) 28%, transparent), color-mix(in srgb, var(--energy-chaleur) 72%, transparent))}
.preview-ranking span:nth-child(3){background:linear-gradient(90deg, rgba(16,185,129,0.25), rgba(16,185,129,0.75))}
.preview-table{display:grid; gap:4px; width:100%; padding:4px 0}
.preview-table span{height:6px; border-radius:3px; background:rgba(148,163,184,0.55)}
.preview-map{display:grid; position:relative; width:100%; height:40px; background:linear-gradient(135deg, rgba(226,232,240,0.6), rgba(203,213,225,0.3)); border-radius:12px; overflow:hidden}
.preview-map--bubbles{place-items:center}
.preview-map--bubbles .bubble{position:absolute; border-radius:50%; opacity:.75; background:var(--energy-electricite)}
.preview-map--bubbles .bubble--1{width:12px; height:12px; left:18px; top:20px}
.preview-map--bubbles .bubble--2{width:20px; height:20px; left:42px; top:12px; background:var(--energy-chaleur)}
.preview-map--bubbles .bubble--3{width:16px; height:16px; left:70px; top:24px; background:var(--energy-froid)}
.preview-map--grid{grid-template-columns:repeat(3, 1fr); gap:4px; padding:8px}
.preview-map--grid span{background:rgba(148,163,184,0.45); border-radius:6px; height:100%}
.preview-monthly{display:flex; align-items:flex-end; gap:3px; width:100%; height:36px}
.preview-monthly--stacked span{flex:1; height:100%; border-radius:4px 4px 2px 2px; background:linear-gradient(180deg, color-mix(in srgb, var(--energy-chaleur) 22%, transparent), color-mix(in srgb, var(--energy-chaleur) 68%, transparent))}
.preview-monthly--line{display:flex; align-items:center; justify-content:center}
.preview-monthly--line svg{width:100%; height:32px; display:block; color:#1f2937}
.preview-distribution{display:flex; align-items:flex-end; gap:4px; width:100%; height:32px}
.preview-distribution--bars span{flex:1; min-width:6px; background:linear-gradient(180deg, rgba(39,125,161,0.18), rgba(39,125,161,0.82)); border-radius:4px 4px 2px 2px; height:calc(var(--h,40) * 1%)}
.preview-distribution--line{display:flex; align-items:center; justify-content:center}
.preview-distribution--line svg{width:100%; height:32px; display:block; color:var(--energy-chaleur)}

@media (max-width: 1024px){
  .map-marker__label{display:none}
  .energy-map{flex-direction:column}
  .map-legend-wrapper{flex-direction:row; flex-wrap:wrap; align-items:center; gap:8px 14px}
}

@media (max-width: 640px){
  .monthly-legend{flex-direction:column; align-items:flex-start}
  .distribution-bars{gap:6px}
}

.chart-catalog{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  height:clamp(280px, 30vh, 520px);
  display:flex;
  justify-content:center;
  padding:24px min(5vw, 36px) calc(26px + env(safe-area-inset-bottom, 0));
  border-top-left-radius:28px;
  border-top-right-radius:28px;
  background:rgba(15,23,42,0.8);
  backdrop-filter:blur(18px);
  box-shadow:0 -32px 80px rgba(15,23,42,0.58);
  transform:translate3d(0, 110%, 0);
  opacity:0;
  transition:transform .48s cubic-bezier(.22,1,.36,1), opacity .32s ease;
  pointer-events:none;
  z-index:60;
  color:#e2e8f0;
}
.chart-catalog.is-open{
  transform:translate3d(0,0,0);
  opacity:1;
  pointer-events:auto;
}
.chart-catalog[hidden]{display:none !important}
.chart-catalog:focus{outline:none}

.chart-catalog__content{
  width:min(1120px, 100%);
  display:flex;
  flex-direction:column;
  gap:18px;
  max-height:100%;
}

.catalog-close{
  align-self:center;
  border:none;
  border-radius:999px;
  width:60px;
  height:34px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:rgba(148,163,184,0.18);
  color:inherit;
  cursor:pointer;
  transition:transform .22s ease, background .22s ease, box-shadow .22s ease;
}
.catalog-close:hover{background:rgba(148,163,184,0.26); transform:translateY(2px)}
.catalog-close:focus-visible{outline:none; box-shadow:0 0 0 4px rgba(191,219,254,0.35)}
.catalog-close__icon svg{display:block}

.catalog-header{display:flex; align-items:center; justify-content:space-between; gap:16px}
.catalog-title{display:flex; align-items:center; gap:12px; font-weight:700; color:#f8fafc}
.catalog-title h4{margin:0; font-size:1.08rem}
.catalog-icon{display:inline-flex; align-items:center; justify-content:center; width:38px; height:38px; border-radius:12px; background:rgba(39,125,161,0.14); color:rgba(39,125,161,0.72); box-shadow:0 8px 18px rgba(15,23,42,0.22)}
.catalog-intro{margin:0; font-size:.88rem; color:rgba(226,232,240,0.78); line-height:1.45; max-width:720px}
.catalog-list{list-style:none; margin:0; padding:4px 4px 10px; display:flex; gap:18px; overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch}
.catalog-list::-webkit-scrollbar{height:8px}
.catalog-list::-webkit-scrollbar-track{background:rgba(15,23,42,0.3); border-radius:999px}
.catalog-list::-webkit-scrollbar-thumb{background:rgba(148,163,184,0.45); border-radius:999px}
.catalog-list > li{flex:0 0 clamp(220px, 26vw, 260px); scroll-snap-align:start}
.catalog-card{
  width:100%;
  min-height:148px;
  padding:16px 18px;
  border-radius:18px;
  border:1px solid rgba(148,163,184,0.32);
  background:linear-gradient(140deg, rgba(148,163,184,0.28), rgba(148,163,184,0.12));
  display:flex;
  align-items:center;
  gap:16px;
  cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
  color:#f8fafc;
  box-shadow:0 18px 36px rgba(15,23,42,0.4);
}
.catalog-card:hover{transform:translateY(-4px); box-shadow:0 26px 44px rgba(39,125,161,0.38); border-color:rgba(39,125,161,0.35)}
.catalog-card:focus-visible{outline:none; box-shadow:0 0 0 4px rgba(191,219,254,0.5)}
.catalog-card.is-active,
.catalog-card[aria-pressed="true"]{
  border-color:rgba(147,197,253,0.9);
  background:linear-gradient(140deg, rgba(96,165,250,0.38), rgba(79,70,229,0.18));
  box-shadow:0 24px 52px rgba(39,125,161,0.42);
}
.catalog-card__preview{
  flex:0 0 96px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height:72px;
  border-radius:14px;
  background:rgba(15,23,42,0.35);
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.35);
}
.catalog-card__text{display:flex; flex-direction:column; align-items:flex-start; gap:6px; text-align:left}
.catalog-card__title{font-weight:700; font-size:1rem; letter-spacing:-0.01em; color:#f8fafc}
.catalog-card__meta{font-size:.82rem; color:rgba(226,232,240,0.72)}

.energy-chart-zone.is-drop-target-zone::after{
  content:"";
  position:absolute;
  inset:-8px;
  border-radius:28px;
  border:2px dashed rgba(147,197,253,0.75);
  background:transparent;
  pointer-events:none;
  z-index:2;
}

[data-chart-slot].is-drop-target-slot{
  outline:2px solid rgba(147,197,253,0.85);
  outline-offset:-6px;
  box-shadow:0 0 0 6px rgba(96,165,250,0.18);
}

body.chart-catalog-dragging{cursor:grabbing; user-select:none; touch-action:none; overscroll-behavior:contain;}

.chart-catalog-drag-ghost{
  position:fixed;
  top:0;
  left:0;
  transform:translate3d(-9999px, -9999px, 0);
  pointer-events:none;
  z-index:120;
  width:clamp(200px, 24vw, 260px);
  padding:16px 18px;
  border-radius:18px;
  background:linear-gradient(140deg, rgba(148,163,184,0.32), rgba(148,163,184,0.14));
  border:1px solid rgba(147,197,253,0.85);
  box-shadow:0 28px 60px rgba(15,23,42,0.55);
  color:#f8fafc;
  display:flex;
  align-items:center;
  gap:16px;
  will-change:transform;
}

.chart-catalog-drag-ghost .catalog-card__preview{
  flex:0 0 88px;
  height:68px;
  border-radius:14px;
  background:rgba(15,23,42,0.35);
  box-shadow:inset 0 0 0 1px rgba(148,163,184,0.38);
}

.chart-catalog-drag-ghost .catalog-card__text{display:flex; flex-direction:column; gap:4px}
.chart-catalog-drag-ghost .catalog-card__title{font-weight:700; font-size:1rem; color:#f8fafc}
.chart-catalog-drag-ghost .catalog-card__meta{font-size:.82rem; color:rgba(226,232,240,0.74)}
.preview-bars{display:flex; align-items:flex-end; gap:6px; width:64px; height:40px}
.preview-bars span{flex:1; display:block; height:calc(var(--h, 40) * 1px); border-radius:6px 6px 4px 4px; background:linear-gradient(180deg, var(--c-blue-soft), var(--c-blue-deep)); opacity:.7; transition:opacity .15s ease}
.preview-bars span[data-active]{background:linear-gradient(180deg, var(--energy-chaleur), var(--energy-chaleur-soft)); opacity:1}
.preview-line{display:block; width:70px; height:42px}
.preview-line svg{width:100%; height:100%}
.preview-line__area{fill:url(#previewLine)}
.preview-line__stroke{fill:none; stroke:var(--c-blue-deep); stroke-width:3; stroke-linecap:round; stroke-linejoin:round}
.preview-line__target{stroke:var(--energy-chaleur); stroke-width:2; stroke-dasharray:4 4; opacity:.8}
.preview-breakdown{display:flex; flex-direction:column; gap:6px; width:72px}
.preview-breakdown span{display:block; height:8px; border-radius:999px; background:linear-gradient(90deg, var(--c-red), var(--c-orange-3)); opacity:.75}
.preview-breakdown span:nth-child(2){width:calc(var(--w, 46) * 1%); background:linear-gradient(90deg, var(--c-teal-muted), var(--c-teal))}
.preview-breakdown span:nth-child(3){width:calc(var(--w, 34) * 1%); background:linear-gradient(90deg, var(--c-green), var(--c-teal))}
.preview-mix{display:flex; align-items:center; justify-content:center}
.preview-mix--pie-primary,.preview-mix--pie-secondary{width:58px; height:58px; border-radius:50%; position:relative; box-shadow:0 0 0 1px rgba(79,70,229,0.16);}
.preview-mix--pie-primary{background:conic-gradient(var(--energy-chaleur) 0 78%, var(--energy-electricite) 78% 93%, var(--energy-froid) 93% 100%)}
.preview-mix--pie-secondary{background:conic-gradient(var(--energy-chaleur) 0 70%, var(--energy-electricite) 70% 90%, var(--energy-froid) 90% 100%)}
.preview-mix--pie-primary::after,.preview-mix--pie-secondary::after{content:""; position:absolute; inset:12px; border-radius:inherit; background:#fff; opacity:.9}
.preview-mix--donut-primary{width:58px; height:58px; border-radius:50%; position:relative; background:conic-gradient(var(--energy-chaleur) 0 80%, var(--energy-electricite) 80% 95%, var(--energy-froid) 95% 100%); color:#0f172a; font-weight:700; font-size:.95rem; letter-spacing:-0.01em}
.preview-mix--donut-primary::after{content:""; position:absolute; inset:16px; border-radius:inherit; background:#fff; opacity:.95}
.preview-mix--donut-primary span{position:relative; z-index:1}
.preview-mix--bars-primary{flex-direction:column; align-items:flex-start; gap:6px; width:64px}
.preview-mix__bar{display:block; height:7px; border-radius:999px; background:linear-gradient(90deg, var(--energy-chaleur), var(--energy-chaleur-soft)); opacity:.9}
.preview-mix__bar:nth-child(2){background:linear-gradient(90deg, var(--c-teal-muted), var(--c-teal)); opacity:.75}
.preview-mix__bar:nth-child(3){background:linear-gradient(90deg, var(--energy-froid), var(--energy-froid)); opacity:.7}
.preview-mix--rings{gap:6px}
.preview-mix--rings span{display:block; width:16px; height:16px; border-radius:50%; background:radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9) 35%, rgba(39,125,161,0.25) 36%, rgba(39,125,161,0.6) 100%); box-shadow:0 0 0 1px rgba(39,125,161,0.25)}
.preview-mix--rings span:nth-child(1){background:radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9) 35%, rgba(243,114,44,0.35) 36%, rgba(243,114,44,0.75) 100%)}
.preview-mix--rings span:nth-child(2){background:radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9) 35%, rgba(67,170,139,0.35) 36%, rgba(67,170,139,0.75) 100%)}
.preview-mix--rings span:nth-child(3){background:radial-gradient(circle at 50% 50%, rgba(255,255,255,0.9) 35%, rgba(39,125,161,0.35) 36%, rgba(39,125,161,0.75) 100%)}
.preview-mix--columns{align-items:flex-end; gap:6px; width:64px; height:46px}
.preview-mix--columns span{display:block; flex:1; border-radius:6px 6px 3px 3px; background:linear-gradient(180deg, rgba(39,125,161,0.2), rgba(39,125,161,0.65)); height:calc(var(--h, 60) * 1%)}
.preview-mix--columns span:nth-child(1){background:linear-gradient(180deg, rgba(249,115,22,0.2), rgba(249,115,22,0.7))}
.preview-mix--columns span:nth-child(2){background:linear-gradient(180deg, rgba(67,170,139,0.2), rgba(67,170,139,0.7))}
.preview-mix--columns span:nth-child(3){background:linear-gradient(180deg, rgba(39,125,161,0.2), rgba(39,125,161,0.7))}
.catalog-footer{margin-top:auto; display:flex; justify-content:flex-end}
.catalog-action{
  border:none;
  border-radius:999px;
  padding:11px 20px;
  font-weight:600;
  background:linear-gradient(135deg, var(--c-blue-deep), var(--c-blue-soft));
  color:#0f172a;
  cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease, filter .2s ease;
  box-shadow:0 20px 38px rgba(39,125,161,0.4);
}
.catalog-action:hover{transform:translateY(-2px); box-shadow:0 26px 46px rgba(39,125,161,0.48); filter:brightness(1.05)}
.catalog-action:focus-visible{outline:none; box-shadow:0 0 0 4px rgba(191,219,254,0.55)}

@media (max-width: 960px){
  .energy-mix-card{width:100%; justify-self:stretch}
  .chart-catalog{
    height:clamp(320px, 38vh, 560px);
    padding:22px min(5vw, 28px) calc(24px + env(safe-area-inset-bottom, 0));
  }
  .catalog-list > li{flex-basis:clamp(220px, 42vw, 280px)}
  .chart-catalog-trigger{
    bottom:18px;
    padding:11px 18px;
  }
}
@media (max-width: 640px){
  .chart-title{padding-right:56px}
  .chart-delete-btn{bottom:12px; top:auto; right:12px; width:34px; height:34px}
  .energy-mix-card{min-width:0}
  .catalog-header{align-items:flex-start}
  .catalog-list{gap:14px; padding:4px 0 8px}
  .catalog-list > li{flex-basis:78%}
  .catalog-card{min-height:136px; padding:14px 16px}
  .catalog-card__preview{flex-basis:84px; height:64px}
  .catalog-close{height:30px; width:54px}
}

@media (prefers-reduced-motion: reduce){
  .chart-catalog{transition:opacity .2s ease; transform:none;}
  .chart-catalog.is-open{transform:none;}
}


.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Chevron hint */
.kpi-chevron{position:absolute; left:50%; bottom:-16px; transform:translateX(-50%); display:none; opacity:.95; pointer-events:none; z-index:2}
.kpi[aria-selected="true"] .kpi-chevron{display:inline-flex; animation:chev 1.4s ease-in-out infinite; color: var(--status)}
@keyframes chev{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(6px)}}

/* Sticky header in panel */
.panel-sticky{pointer-events:none; position:sticky; top:0; display:flex; align-items:center; gap:10px; padding:12px 16px; background:#fff; z-index:10; transition:opacity .25s ease, transform .25s ease; opacity:1; transform:translateY(0); border-top-left-radius:14px; border-top-right-radius:14px;}
.ps-icon svg{width:18px; height:18px; display:block}
.ps-label{font-weight:700; color:#111827}
.ps-dot{margin-left:auto; width:12px; height:12px; border-radius:999px; background:var(--active-color, #cbd5e1); position:relative; box-shadow:0 0 4px var(--active-color, #94a3b8), 0 0 10px var(--active-color, #94a3b8);}

.panel-box{
  border:2px solid var(--active-color, #cbd5e1); border-radius:16px; background:#fff; padding:16px;
  box-shadow:0 6px 16px rgba(16,24,40,.06); position:relative; width:100%;
}
.panel-sticky.is-idle{opacity:0; transform:translateY(-8px); pointer-events:none}
.panel-top-sentinel{position:absolute; top:0; left:0; width:1px; height:1px; pointer-events:none}

/* Glow animations */
.kpi-dot::after{content:""; position:absolute; inset:-6px; border-radius:inherit; background:radial-gradient(circle at center, var(--status) 14%, rgba(255,255,255,0) 55%); filter:blur(4px); opacity:.35; animation:dot-glow 2.2s ease-in-out infinite}
.kpi[aria-selected="true"] .kpi-dot::after{animation:dot-glow-strong 1.6s ease-in-out infinite; opacity:.5}
@keyframes dot-glow{0%,100%{transform:scale(1); opacity:.32}50%{transform:scale(1.12); opacity:.5}}
@keyframes dot-glow-strong{0%,100%{transform:scale(1.02); opacity:.45}50%{transform:scale(1.18); opacity:.75}}
@media (prefers-reduced-motion: reduce){
  .kpi-dot::after{animation:none; opacity:.4}
  .kpi[aria-selected="true"] .kpi-dot::after{animation:none; opacity:.6}
}
.ps-dot::after{content:""; position:absolute; inset:-6px; border-radius:inherit; background:radial-gradient(circle at center, var(--active-color) 14%, rgba(255,255,255,0) 55%); filter:blur(4px); opacity:.35; animation:dot-glow 2.2s ease-in-out infinite}
.panel-sticky .ps-dot::after{animation:dot-glow-strong 1.6s ease-in-out infinite; opacity:.5}
@media (prefers-reduced-motion: reduce){ .ps-dot::after{animation:none; opacity:.6} }

.ti-ico svg{ width: calc(18px * var(--top-scale)); height: calc(18px * var(--top-scale)); display:block }
.ti-label{white-space:nowrap}

/* === Layout global avec sidebar === */
.app{
  display:grid; grid-template-columns: 260px 1fr; gap:16px;
  max-width: var(--container-max) !important;
  margin:0 auto; padding:12px 12px 24px;
}
.main{ min-width:0; }
@media (max-width: 960px){ .app{ grid-template-columns: 1fr; } .side-nav{ order:-1; } }

/* === Sidebar / Tree (fusion, priorité bas) === */
.side-nav{
  position: sticky; top: var(--sidebar-top); align-self: start;
  background: #fff; border-right: 1px solid #ddd; padding: 0;
  max-height: calc(100vh - var(--sidebar-top)); overflow-y: auto;
}
.tree{
  display:flex;
  flex-direction:column;
  gap:4px;
  --tree-accent: var(--c-green);
  --tree-accent-bg: color-mix(in srgb, var(--tree-accent) 18%, white 82%);
  --tree-accent-glow: color-mix(in srgb, var(--tree-accent) 36%, transparent);
  --tree-accent-ring: color-mix(in srgb, var(--tree-accent) 52%, transparent);
  --tree-accent-focus: color-mix(in srgb, var(--tree-accent) 42%, transparent);
  --tree-check-bg: color-mix(in srgb, var(--tree-accent) 24%, white 76%);
  --tree-missing: var(--c-red);
  --tree-missing-soft: color-mix(in srgb, var(--tree-missing) 12%, white 88%);
  --tree-missing-hover: color-mix(in srgb, var(--tree-missing) 18%, white 82%);
  --tree-missing-bg: color-mix(in srgb, var(--tree-missing) 18%, transparent);
  --tree-missing-strong: color-mix(in srgb, var(--tree-missing) 70%, transparent);
  --tree-missing-focus: color-mix(in srgb, var(--tree-missing) 48%, transparent);
  --tree-missing-ring: color-mix(in srgb, var(--tree-missing) 60%, transparent);
}
.tree-group{ margin-top:2px; }
.tree-children{
  list-style:none; margin:4px 0 6px 14px; padding:0 0 0 10px;
  border-left: 1px dashed rgba(0,0,0,.12); display:flex; flex-direction:column; gap:2px;
}
.tree-children[hidden]{ display:none !important; }

.tree-node, .tree-leaf{
  --tree-ring-bg: transparent;
  --tree-ring-color: transparent;
  appearance:none; border:none; background:transparent; cursor:pointer; width:100%; text-align:left; color:#0f172a;
  padding:6px 8px 6px 6px; display:flex; align-items:center; gap:8px; border-radius:6px; transition: color .15s ease, background .15s ease, box-shadow .15s ease;
  position:relative;
}
.tree-leaf__label{ flex:1 1 auto; min-width:0; }
.tree-leaf__missing-info{
  flex:0 0 auto;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:18px;
  height:18px;
  border-radius:50%;
  border:1px solid var(--tree-missing-strong);
  background:var(--tree-missing-soft);
  color:var(--tree-missing);
  cursor:pointer;
  transition: background .15s ease, border-color .15s ease, color .15s ease;
}
.tree-leaf__missing-info svg{
  width:12px;
  height:12px;
  display:block;
}
.tree-leaf__missing-info:hover,
.tree-leaf__missing-info[aria-expanded="true"]{
  background:var(--tree-missing-hover);
  border-color:color-mix(in srgb, var(--tree-missing) 78%, transparent);
  color:var(--tree-missing);
}
.tree-leaf__missing-info:focus-visible{
  outline:none;
  box-shadow:0 0 0 3px var(--tree-missing-focus);
}
.tree-leaf__missing-popover{
  position:fixed;
  top:50%;
  left:50%;
  transform:translateY(-50%);
  min-width:220px;
  max-width:280px;
  padding:12px 16px;
  border-radius:12px;
  border:1px solid rgba(148, 163, 184, 0.55);
  border-left:3px solid var(--tree-missing-ring);
  background:#fff;
  color:#1f2937;
  font-size:.84rem;
  line-height:1.45;
  box-shadow:0 16px 34px rgba(15, 23, 42, 0.16);
  z-index:9999;
}
.tree-leaf__missing-popover::before{
  content:"";
  position:absolute;
  top:50%;
  left:-12px;
  transform:translateY(-50%);
  border-width:10px 12px 10px 0;
  border-style:solid;
  border-color:transparent rgba(148, 163, 184, 0.55) transparent transparent;
  filter:drop-shadow(-1px 1px 0 rgba(15, 23, 42, 0.08));
}
.tree-leaf__missing-popover::after{
  content:"";
  position:absolute;
  top:50%;
  left:-9px;
  transform:translateY(-50%);
  border-width:9px 11px 9px 0;
  border-style:solid;
  border-color:transparent #fff transparent transparent;
}
.tree-leaf__missing-popover-line + .tree-leaf__missing-popover-line{
  margin-top:4px;
}
.tree-node:hover, .tree-leaf:hover{ background:rgba(0,0,0,.03); color:#0b1220; }
.tree-leaf.is-active,
.tree-node.is-active{
  --tree-ring-bg: var(--tree-accent-bg);
  --tree-ring-color: var(--tree-accent-ring);
  font-weight: 700;
  position: relative;
}

.tree-leaf.is-missing.is-active,
.tree-node.is-missing.is-active{
  --tree-ring-bg: var(--tree-missing-bg);
  --tree-ring-color: var(--tree-missing-ring);
}

.tree-leaf.is-active,
.tree-node.is-active{
  background: var(--tree-ring-bg);
  box-shadow: inset 0 0 0 2px var(--tree-ring-color);
}
.tree-node.is-partial::after{
  content:""; position:absolute; left:-6px; top:50%; transform:translateY(-50%);
  width:6px; height:2px; border-radius:2px; background: var(--section-color, var(--c-blue-deep)); opacity:.7;
}
.tree-check {
  appearance:none;
  margin-right: 6px;
  cursor: pointer;
  width: 16px;
  height: 16px;
  border: 2px solid rgba(15, 23, 42, 0.25);
  border-radius: 4px;
  background:#fff;
  display:grid;
  place-items:center;
  transition: border-color .15s ease, background .15s ease, color .15s ease, box-shadow .15s ease;
  color:var(--tree-accent);
  font-size: 11px;
  font-weight:700;
  line-height:1;
}
.tree-check::after{
  content:'✔';
  transform:scale(.55);
  opacity:0;
  transition: opacity .18s ease, transform .18s ease;
}
.tree-check:hover{
  border-color: rgba(15, 23, 42, 0.35);
}
.tree-check:checked{
  background:var(--tree-check-bg);
  border-color:var(--tree-accent);
  box-shadow:0 0 0 2px var(--tree-accent-glow);
}
.tree-check:checked::after{
  opacity:1;
  transform:scale(1);
}
.tree-check:focus-visible{
  outline:none;
  box-shadow:0 0 0 3px var(--tree-accent-focus);
}
.tree-leaf.is-missing .tree-check,
.tree-node.is-missing .tree-check{
  color:var(--tree-missing);
}
.tree-leaf.is-missing .tree-check::after,
.tree-node.is-missing .tree-check::after{
  content:'✕';
  transform:scale(.55);
}
.tree-leaf.is-missing .tree-check:checked,
.tree-node.is-missing .tree-check:checked{
  background:color-mix(in srgb, var(--tree-missing) 22%, white 78%);
  border-color:var(--tree-missing);
  box-shadow:0 0 0 2px color-mix(in srgb, var(--tree-missing) 40%, transparent);
}
.tree-leaf.is-missing .tree-check:checked::after,
.tree-node.is-missing .tree-check:checked::after{
  opacity:1;
  transform:scale(.9);
}
.tree-leaf.is-missing .tree-check:not(:checked),
.tree-node.is-missing .tree-check:not(:checked){
  border-color: rgba(15, 23, 42, 0.25);
}
.tree-leaf.is-missing .tree-check:not(:checked)::after,
.tree-node.is-missing .tree-check:not(:checked)::after{
  opacity:0;
  transform:scale(.55);
}
.tree-leaf.is-missing.is-active .tree-check,
.tree-node.is-missing.is-active .tree-check{
  border-color:var(--tree-missing);
}
.tree-leaf.is-missing .tree-check:focus-visible,
.tree-node.is-missing .tree-check:focus-visible{
  box-shadow:0 0 0 3px var(--tree-missing-focus);
}
.chev{ width:14px; display:inline-block; transform-origin:center; opacity:.6; }
.tree-node[aria-expanded="false"] .chev{ transform:rotate(-90deg); }

/* Alignement avec les onglets (fusion, priorité bas mais cohérence vars) */
.sidebar-header { padding: 1rem; background: #f8f9fa; text-align: center; border-bottom: 1px solid #ddd; }
.logo-title { font-family: 'Segoe UI', sans-serif; font-weight: 800; font-size: 1.4rem; color: var(--c-blue-deep); letter-spacing: 1px; }

/* Hamburger + overlay mobile */
.hamburger{ display:none; width:38px; height:34px; border:none; background:transparent; border-radius:8px; align-items:center; justify-content:center; gap:5px; padding:0 6px; cursor:pointer; }
.hamburger span{ display:block; width:22px; height:2px; background:#0f172a; border-radius:2px; }
@media (max-width: 960px){
  .hamburger{ display:flex; }
  .side-overlay{ position: fixed; inset:0; background: rgba(16,24,40,.28); backdrop-filter: blur(2px); z-index: 40; }
  body.menu-open #sidebar{ transform: translateX(0); }
  body.menu-open .side-overlay{ display:block; }
  .side-overlay[hidden]{ display:none; }
}

/* ===== Mini KPI (sections hors Énergie) ===== */
.kpi-tabs--alt { display:grid; grid-template-columns:repeat(3,minmax(170px,1fr)); gap:12px; }
@media (max-width:1100px){ .kpi-tabs--alt{ grid-template-columns:repeat(3,1fr);} }
@media (max-width:640px){ .kpi-tabs--alt{ grid-template-columns:repeat(2,1fr);} }
.kpi.kpi--alt{ cursor:default; }
.kpi.kpi--alt:hover{ transform:none; }
.kpi.kpi--alt .kpi-chevron{ display:none; }

/* Zone droite dans la barre du haut (fusion) */
.top-right{
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Mobile : évite l’écrasement si la barre ne wrap pas */
@media (max-width: 640px){
  .year-picker{ height: 32px; font-size: .9rem; }
}

/* élargit le conteneur global (sidebar + main) */
.app{ max-width: var(--container-max) !important; }
/* élargit uniquement la “div du milieu” */
.kpi-wrap,
.section .tabset{
  max-width: var(--content-max) !important;
  margin-left: auto;
  margin-right: auto;
}

/* ==== Barre de recherche (sidebar) ==== */
.side-search{
  padding: 12px; background: #fff; border-bottom: 1px solid rgba(0,0,0,.05);
}
.search-input{
  display:flex; align-items:center; gap:8px;
  border:1px solid var(--border); background:#fff; border-radius:10px; padding:6px 8px;
}
.search-input:focus-within{ box-shadow:0 0 0 6px var(--ring); }
.search-input input{
  appearance:none; border:none; outline:none; width:100%;
  font-size:.95rem; font-weight:600; color:#0f172a; background:transparent;
}
.s-ico{ opacity:.6; display:inline-flex; }
.s-clear{ border:none; background:var(--c-blue-deep); color:#0f172a; border-radius:8px; padding:2px 6px; cursor:pointer;
  font-weight:700; line-height:1; }
.s-clear:hover{ background:#e2e8f0; }
.s-meta{ margin-top:6px; font-size:.8rem; color:#64748b; }
/* Cache la croix native des champs search (Chrome/Safari/Edge) */
.search-input input::-webkit-search-cancel-button { -webkit-appearance: none; appearance: none; display: none; }
.search-input input::-ms-clear { display: none; width: 0; height: 0; }

/* ==== Pastilles (badges) dans l’arborescence ==== */
.tree .badge{
  margin-left: auto;
  padding: 4px 8px;
  border-radius: 999px;
  font-size: .75rem;
  font-weight: 800;
  line-height: 1;
  letter-spacing: .02em;
  white-space: nowrap;
  background: #f1f5f9;
  color: #0f172a;
  border: 1px solid var(--border);
}
.tree-node:hover .badge,
.tree-leaf:hover .badge{ background:#eef2f7; }
.tree-node.is-active .badge{
  background: var(--c-teal); color: #fff;
  border-color: color-mix(in srgb, var(--tree-accent) 55%, transparent);
  box-shadow: 0 0 0 1px rgba(255,255,255,.15) inset;
}
@media (max-width: 640px){
  .tree .badge{ padding: 3px 7px; font-size: .72rem; }
}

/* ==== Filtres inline (onglet Énergie) ==== */
.filters-inline{
  margin: 8px 0 12px; padding: 12px;
  background:#fff; border:1px solid var(--border); border-radius:12px;
  box-shadow: 0 2px 8px rgba(16,24,40,.05);
  --ctrl-h: 32px;
  --ctrl-fs: .9rem;
  --ctrl-px: 10px;
}
/* Champs natifs du groupe .filters-inline : plus compacts */
.filters-inline select,
.filters-inline input[type="text"],
.filters-inline input[type="number"],
.filters-inline input[type="search"],
.filters-inline button,
#energy-filters [role="combobox"],
#energy-filters [aria-haspopup="listbox"]{
  height: var(--ctrl-h) !important;
  min-height: var(--ctrl-h) !important;
  padding: 0 var(--ctrl-px) !important;
  font-size: var(--ctrl-fs) !important;
  line-height: calc(var(--ctrl-h) - 2px) !important;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: #fff;
  appearance: none; -webkit-appearance: none;
  box-sizing: border-box;
}

.fi-grid{
  display:grid; gap:12px;
  grid-template-columns: repeat(4, minmax(200px, 1fr));
}
@media (max-width: 1200px){ .fi-grid{ grid-template-columns: repeat(2, minmax(200px, 1fr)); } }
@media (max-width: 640px){  .fi-grid{ grid-template-columns: 1fr; } }

.fi-item{ display:flex; flex-direction:column; gap:8px; }
.fi-label{ font-size:.85rem; font-weight:700; color:#111827; }

/* Était: .year-picker { ... }  -> Devient: */
#year-picker, .year-picker{ position:relative; display:inline-flex; --year-scale: 1.2; }


/* Était: .year-picker .year-btn { ... } -> Devient: */
#year-picker .year-btn,
.year-picker .year-btn{ 
  appearance:none;
  display:inline-flex; align-items:center; gap: calc(8px * var(--year-scale));
  padding: calc(8px * var(--year-scale)) calc(12px * var(--year-scale));
  height: calc(34px * var(--year-scale));
  border-radius:9999px; background:#fff; border:1px solid var(--border);
  box-shadow:0 1px 2px rgba(16,24,40,.05);
  font-weight:700; font-size: calc(.95rem * var(--year-scale));
  line-height:1; color:#0f172a; cursor:pointer;
}

/* Était: .year-picker .year-chev { ... } -> Devient: */
#year-picker .year-chev,
.year-picker .year-chev{
  width: calc(18px * var(--year-scale)); height: calc(18px * var(--year-scale));
  opacity:.7; transition:transform .18s ease;
}

/* Était: .year-picker .year-btn[aria-expanded="true"] .year-chev -> Devient: */
#year-picker .year-btn[aria-expanded="true"] .year-chev,
.year-picker .year-btn[aria-expanded="true"] .year-chev{ transform:rotate(180deg); }

/* Était: .year-picker .year-menu -> Devient: */
#year-picker .year-menu,
.year-picker .year-menu{
  position:absolute; right:0; top:calc(100% + 10px);
  min-width: calc(160px * var(--year-scale));
  max-height:260px; overflow:auto;
  border:1px solid var(--hairline, #e5e7eb);
  background:color-mix(in oklab, white 92%, transparent);
  border-radius:12px; padding:6px; z-index:1000;
  box-shadow:0 8px 24px rgba(0,0,0,.08), 0 4px 10px rgba(0,0,0,.06);
}

#year-picker .year-menu [role="option"],
.year-picker .year-menu [role="option"]{
  display:flex; align-items:center; gap:.5rem;
  padding:6px 8px; border-radius:6px; cursor:pointer;
  user-select:none; white-space:nowrap;
}
#year-picker .year-menu [role="option"].is-active,
#year-picker .year-menu [role="option"]:hover,
.year-picker .year-menu [role="option"].is-active,
.year-picker .year-menu [role="option"]:hover{
  background:color-mix(in oklab, var(--section-color) 12%, transparent);
}
#year-picker .year-menu [role="option"].is-selected,
#year-picker .year-menu [role="option"][aria-selected="true"],
.year-picker .year-menu [role="option"].is-selected,
.year-picker .year-menu [role="option"][aria-selected="true"]{
  font-weight:600;
}

/* petit ajustement mobile si besoin */
@media (max-width: 640px){
  #year-picker, .year-picker{ --year-scale: 1.2; }
  #year-picker .year-btn, .year-picker .year-btn{
    height: calc(32px * var(--year-scale));
    padding: calc(6px * var(--year-scale)) calc(10px * var(--year-scale));
    font-size: calc(.9rem * var(--year-scale));
  }
  #year-picker .year-chev, .year-picker .year-chev{
    width: calc(18px * var(--year-scale)); height: calc(18px * var(--year-scale));
  }
}


/* (optionnel) caler visuellement à droite du header */
.top-right{ display:flex; align-items:center; margin-left:auto; }

/* =========================
   Filtres pro (discrets)
   ========================= */
#energy-filters,
#energy-filters fieldset,
#energy-filters .filter-card {
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  padding: 0;
  margin: 10px 0 28px;   /* ← au lieu de 6px 0 14px */
}

#energy-filters {
  --txt-1: var(--text-color, #0f172a);
  --txt-2: color-mix(in oklab, var(--txt-1) 65%, transparent);
  --hairline: color-mix(in oklab, var(--txt-1) 14%, transparent);
  display: flex; align-items: center; flex-wrap: wrap;
  gap: 10px 14px; font-size: 14px;
  --ctrl-h: 32px;
  --ctrl-fs: .9rem;
  --ctrl-px: 10px;
}
#energy-filters > div:not(:first-child),
#energy-filters > fieldset:not(:first-child) {
  position: relative; padding-left: 12px;
}
#energy-filters > div:not(:first-child)::before,
#energy-filters > fieldset:not(:first-child)::before {
  content: ""; position: absolute; left: 0; top: 50%;
  width: 1px; height: 14px; background: var(--hairline); transform: translateY(-50%);
}
#energy-filters .f-label { opacity: .65; font-weight: 500; margin-right: 2px; }

/* === SegSwitch (pilule sous le texte) — version concise === */
.seg2{
  --h: var(--ctrl-h, 40px);       /* garde ta hauteur pilotée */
  --r:999px; --bg:#f1f5f9; --bd:#e5e7eb; --pill:#fff;
  --txt:#0f172a; --muted:#6b7280; --pad-x: 8px;   /* padding + serré */
  --minw: 0;                                      /* plus de largeur mini */
  position:relative;
  display:inline-grid;                             /* évite l’étirement full ligne */
  grid-template-columns: 1fr 1fr;                  /* moitiés égales pour la pillule */
  align-items:center;
  background:var(--bg); border:1px solid var(--bd); border-radius:var(--r);
  padding:4px;
  height:calc(var(--h) + 8px);
  min-width: var(--minw);
  width: fit-content;                              /* largeur au contenu */
  overflow:hidden;
  -webkit-tap-highlight-color:transparent;
}
.seg2 > input[type="radio"]{ appearance:none; position:absolute; width:0; height:0; margin:0; opacity:0; pointer-events:none; }
.seg2 > label{
  position:relative; z-index:2; display:flex; align-items:center; justify-content:center;
  height:var(--h); padding:0 var(--pad-x); border-radius:var(--r);
  font: 700 var(--ctrl-fs, .95rem)/1 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--muted); cursor:pointer; white-space:nowrap;
}
.seg2 .pill{
  position:absolute; inset:4px auto 4px 4px; width:calc(50% - 4px);
  background:var(--pill); border:1px solid var(--bd); border-radius:var(--r);
  box-shadow:0 1px 2px rgba(16,24,40,.06); z-index:1; pointer-events:none;
  transition:transform .22s ease;
}
.seg2:has(input:last-of-type:checked) .pill{ transform:translateX(100%); }
.seg2:has(input:first-of-type:checked) > label:first-of-type,
.seg2:has(input:last-of-type:checked)  > label:last-of-type{ color:var(--txt); }
.seg2:has(input:focus-visible){ outline:2px solid #cbd5e1; outline-offset:2px; }

/* — reset anciens styles dans les seg2 — */
#energy-filters .seg2 label{ outline:none!important; box-shadow:none!important; padding:0 var(--pad-x)!important; }
#energy-filters .seg2 label::before,
#energy-filters .seg2 label::after{ content:none!important; }

/* mobile */
@media (max-width:640px){ .seg2{ --h:36px; --minw:220px; } .seg2 > label{ font-size:.9rem; } }
/* Bloc filtres (même style que ta sidebar) */
.side-nav .side-filters{ padding:10px 12px; background:#fff; border-bottom:1px solid rgba(0,0,0,.05); }
.side-nav .ms-group{ margin:8px 0 14px; }
.side-nav .ms-label{ font-weight:800; font-size:.9rem; color:#0f172a; margin-bottom:6px; }

/* Composant multi-select */
.ms{ position:relative; }
.ms-btn{
  width:100%; height:32px; padding:0 10px;
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  border:1px solid var(--border); border-radius:10px; background:#fff;
  font-weight:700; font-size:.9rem; color:#0f172a; cursor:pointer;
}
.ms-btn:focus-visible{ outline:none; box-shadow:0 0 0 6px var(--ring); }
.ms-chev{ width:16px; height:16px; opacity:.6; flex:0 0 auto; transition:transform .18s ease; }
.ms[aria-open="true"] .ms-chev{ transform:rotate(180deg); }

.ms-menu{
  position:absolute; left:0; right:0; top:calc(100% + 6px);
  background:#fff; border:1px solid var(--border); border-radius:12px; padding:6px;
  box-shadow:0 8px 24px rgba(0,0,0,.08), 0 4px 10px rgba(0,0,0,.06);
  max-height:220px; overflow:auto; z-index:1000; display:none;
}
.ms[aria-open="true"] .ms-menu{ display:block; }

.ms-option{
  display:flex; align-items:center; gap:8px;
  padding:6px; border-radius:6px; cursor:pointer; user-select:none;
  font-size:.9rem; color:#0f172a;
}
.ms-option:hover{ background:rgba(0,0,0,.03); }
.ms-option input{ width:16px; height:16px; margin:0; accent-color:var(--c-teal); }

/* Bouton Effacer aligné à droite, discret */
.ms-clear{
  margin-top:6px; margin-left:auto; display:inline-block;
  background:transparent; border:none; color:var(--c-teal); font-weight:700; font-size:.8rem; cursor:pointer; padding:2px 4px; border-radius:6px;
}
.ms-clear:hover{ background:rgba(16,185,129,.08); }

/* Compact sur petits écrans si besoin */
@media (max-width:640px){
  .ms-btn{ height:30px; font-size:.88rem; }
  .ms-menu{ max-height:200px; }
}
.filters-toggle-btn {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.3em;
  margin: 1em 0 0.5em 1em;
  padding: 0.3em;
  font-size: 1.1em;
}
#filters-panel[hidden] {
  display: none !important;
}
#filters-panel {
  margin-bottom: 1em;
  padding: 0.5em 1em 0.5em 1em;
  background: #f9fafb;
  border-radius: 12px;
  box-shadow: 0 1px 5px 0 rgba(60,80,110,0.04);
}
