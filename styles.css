/**********************************************************
 *  Design système — version épurée & pro
 *  -> Collez ce fichier tel quel, il remplace l’existant
 **********************************************************/

/* =========================
   0) Tokens & reset
   ========================= */
:root{
  /* Couleurs de base */
  --bg:#f6f7f9;
  --card:#ffffff;
  --ink:#101828;
  --muted:#667085;
  --border:#e5e7eb;
  --ring: rgba(76,132,255,.35);

  /* Sections */
  --section-color:#94a3b8;
  --sec-energie:#60a5fa;
  --sec-travaux:#b45309;
  --sec-financier:#facc15;
  --sec-etat:#10b981;

  /* États KPI */
  --kpi-good:#16a34a;
  --kpi-warn:#f59e0b;
  --kpi-bad:#ef4444;

  /* Switch iOS */
  --switch-on:#34c759;
  --switch-off:#e5e7eb;
  --switch-knob:#fff;

  /* Layout */
  --sticky-top: 60px;
  --container-max: 1440px;
  --content-max:   1280px;

  /* Aides */
  --hairline: color-mix(in srgb, var(--ink) 14%, transparent);
  --txt-1: var(--ink);
  --txt-2: color-mix(in srgb, var(--ink) 60%, transparent);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  background:var(--bg);
  color:var(--ink);
  font-family:Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  overflow-x:hidden;
  margin:0;
}

img,svg{ display:block; max-width:100%; }

/* =========================
   1) Layout global
   ========================= */
.app{
  display:grid; grid-template-columns: 260px 1fr;
  gap:16px; max-width:var(--container-max); margin:0 auto; padding:12px 12px 24px;
}
.main{ min-width:0; }
@media (max-width: 960px){
  .app{ grid-template-columns:1fr; }
  .side-nav{ order:-1; }
}

/* =========================
   2) Top nav (sections)
   ========================= */
.top-nav{
  position:relative; z-index:10;
  display:flex; gap:20px; margin:0 0 20px; padding:0 0 6px;
  border-bottom:1px solid rgba(0,0,0,.06);
  align-items:center; flex-wrap:wrap;
}
.top-item{
  appearance:none; border:none; background:transparent; color:#0f172a;
  padding:8px 6px; font-weight:700; font-size:.95rem; cursor:pointer;
  display:flex; align-items:center; gap:8px; position:relative;
}
.top-item:hover{ opacity:.9; }
.top-item:focus-visible{ outline:none; box-shadow:0 0 0 6px var(--ring); border-radius:6px; }
.top-item.is-active{ color:#0f172a; }
.top-item.is-active::after{
  content:""; position:absolute; left:0; right:0; bottom:-10px;
  height:3px; border-radius:2px; background:var(--section-color);
}
@media (max-width:640px){
  .top-nav{ flex-wrap:nowrap; gap:14px; margin-bottom:14px; }
}

/* Zone utilitaire à droite */
.top-right{
  margin-left:auto; display:flex; align-items:center; gap:10px;
}

/* =========================
   3) Year picker (custom, #year-picker)
   ========================= */
#year-picker{ position:relative; display:inline-flex; }
#year-picker .year-btn{
  display:flex; align-items:center; gap:.5rem;
  padding:.5rem .875rem; border-radius:9999px;
  border:1px solid var(--border); background:#fff;
  font-weight:700; line-height:1; cursor:pointer; font-size:.95rem;
  box-shadow:0 1px 2px rgba(0,0,0,.05);
  transition: border-color .15s ease, background .15s ease, box-shadow .15s ease;
}
#year-picker .year-btn:hover{ background:#fff; border-color:#d1d5db; }
#year-picker .year-btn:focus-visible{ outline:2px solid var(--section-color); outline-offset:2px; }
#year-picker .chev{ width:16px; height:16px; opacity:.6; transition: transform .18s ease; }
#year-picker .year-btn[aria-expanded="true"] .chev{ transform:rotate(180deg); }

#year-picker .year-menu{
  position:absolute; right:0; top:calc(100% + 8px);
  min-width:160px; max-height:260px; overflow:auto;
  background:#fff; border:1px solid var(--hairline); border-radius:12px;
  padding:6px; z-index:1000;
  box-shadow: 0 10px 30px rgba(0,0,0,.12), 0 4px 10px rgba(0,0,0,.06);
}
#year-picker .year-menu [role="option"]{
  display:flex; align-items:center; gap:.5rem;
  padding:.5rem .75rem; border-radius:8px; cursor:pointer; user-select:none; white-space:nowrap;
}
#year-picker .year-menu [role="option"]:hover,
#year-picker .year-menu [role="option"].is-active{
  background: color-mix(in srgb, var(--section-color) 14%, transparent);
}
#year-picker .year-menu [role="option"].is-selected{
  font-weight:700;
  background: color-mix(in srgb, var(--section-color) 18%, transparent);
}

/* =========================
   4) KPI tiles & panels
   ========================= */
.kpi-wrap{ max-width:var(--content-max); margin:18px auto; padding:0 12px; }
.kpi-tabs{ display:grid; grid-template-columns:repeat(6, minmax(170px,1fr)); gap:12px; align-items:stretch; }
@media (max-width:1100px){ .kpi-tabs{ grid-template-columns:repeat(3,1fr); } }
@media (max-width:640px){ .kpi-tabs{ grid-template-columns:1fr 1fr; } }

.kpi{
  --status:#8a8a8a; --tint:rgba(0,0,0,.04);
  position:relative; display:grid; grid-template-rows:auto auto 1fr auto; gap:6px;
  padding:16px; border-radius:16px; background:var(--card); border:1px solid var(--border);
  cursor:pointer; text-align:center; justify-items:center;
  transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
  box-shadow:0 1px 0 rgba(0,0,0,.02), 0 8px 24px rgba(16,24,40,.06);
}
.kpi:hover{ transform:translateY(-2px); }
.kpi:focus-visible{ outline:none; box-shadow:0 0 0 6px var(--ring); }
.kpi:not([aria-selected="true"]){ opacity:.86; filter:saturate(.92); }

.kpi[data-status="good"]{ --status:var(--kpi-good); --tint:color-mix(in srgb, var(--kpi-good) 18%, transparent); }
.kpi[data-status="warn"]{ --status:var(--kpi-warn); --tint:color-mix(in srgb, var(--kpi-warn) 20%, transparent); }
.kpi[data-status="bad"] { --status:var(--kpi-bad);  --tint:color-mix(in srgb, var(--kpi-bad)  18%, transparent); }

.kpi-head{ display:flex; align-items:center; justify-content:center; gap:8px; }
.kpi-icon{ display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; background:var(--tint); color:var(--status); }
.kpi-label{ font-size:1.05rem; font-weight:800; letter-spacing:.01em; color:#1f2937; min-height:1.6rem; }
.kpi-title{ font-size:.95rem; margin-top:2px; color:#334155; min-height:2rem; }

.kpi-value-wrap{ position:relative; width:100%; height:2.6rem; padding-inline: calc(var(--trend-w, 0px) + 8px); }
.kpi-value{
  position:absolute; left:50%; transform:translateX(-50%);
  font-size:2rem; font-weight:800; line-height:2.6rem; margin:0;
  font-variant-numeric:tabular-nums; letter-spacing:-0.01em; color:var(--status);
  width: calc(var(--value-ch, 6) * 1ch); text-align:center;
}
.kpi-unit{ font-size:.85rem; color:var(--muted); min-height:1.4rem; }

.kpi-trend{
  position:absolute; right:0; top:50%; transform:translateY(-50%);
  font-size:.75rem; font-weight:700; white-space:nowrap;
}
.trend-up{ color:var(--kpi-bad); }
.trend-down{ color:var(--kpi-good); }

.kpi[aria-selected="true"]{
  transform:translateY(-4px) scale(1.02);
  border-color:#cbd5e1;
  box-shadow:0 10px 28px rgba(16,24,40,.14), 0 0 0 2px var(--status) inset;
}
.kpi[aria-selected="true"] .kpi-icon{ background:var(--tint); color:var(--status); }
.kpi[aria-selected="true"] .kpi-title{ color:#111827; }

.kpi-dot{
  position:absolute; top:10px; right:10px; width:14px; height:14px; border-radius:999px; background:var(--status);
  box-shadow:0 0 0 4px var(--tint), 0 0 0 1px rgba(0,0,0,.08) inset, 0 0 4px var(--status), 0 0 10px var(--status);
}
.kpi[aria-selected="true"] .kpi-dot{
  box-shadow:0 0 0 6px var(--tint), 0 0 0 2px var(--status) inset, 0 0 6px var(--status), 0 0 14px var(--status);
}

/* petit chevron “hint” */
.kpi-chevron{ position:absolute; left:50%; bottom:-16px; transform:translateX(-50%); display:none; opacity:.95; pointer-events:none; z-index:2; color:var(--status); }
.kpi[aria-selected="true"] .kpi-chevron{ display:inline-flex; animation:chev 1.4s ease-in-out infinite; }
@keyframes chev{ 0%,100%{ transform:translateX(-50%) translateY(0) } 50%{ transform:translateX(-50%) translateY(6px) } }

/* Panels */
.section{ margin-top:16px; }
.section[hidden]{ display:none; }
.kpi-panels{ margin-top:18px; background:transparent; border:none; padding:16px 0 0; }
.kpi-panels section[hidden]{ display:none; }
.kpi-panels h3{ margin:.2rem 0 .4rem 0; }
.meter{ height:10px; background:#eef2f6; border-radius:8px; overflow:hidden; border:1px solid var(--border); }
.meter > div{ height:100%; width:0; background:var(--active-color, #94a3b8); }

/* Sticky header dans le panel */
.panel-sticky{
  pointer-events:none; position:sticky; top:0; display:flex; align-items:center; gap:10px;
  padding:12px 16px; background:#fff; z-index:10;
  transition:opacity .25s ease, transform .25s ease; opacity:1; transform:translateY(0);
  border-top-left-radius:14px; border-top-right-radius:14px;
}
.panel-sticky.is-idle{ opacity:0; transform:translateY(-8px); pointer-events:none; }
.ps-icon svg{ width:18px; height:18px; }
.ps-label{ font-weight:700; color:#111827; }
.ps-dot{
  margin-left:auto; width:12px; height:12px; border-radius:999px; background:var(--active-color, #cbd5e1); position:relative;
  box-shadow:0 0 4px var(--active-color, #94a3b8), 0 0 10px var(--active-color, #94a3b8);
}
.panel-box{
  border:2px solid var(--active-color, #cbd5e1); border-radius:16px; background:#fff; padding:16px;
  box-shadow:0 6px 16px rgba(16,24,40,.06); width:100%; position:relative;
}
.panel-top-sentinel{ position:absolute; top:0; left:0; width:1px; height:1px; pointer-events:none; }

/* =========================
   5) Sidebar / Tree
   ========================= */
.side-nav{
  position: sticky; top: var(--sticky-top); align-self:start; background:transparent;
  border-right:1px solid rgba(0,0,0,.05); padding-right:12px;
  max-height: calc(100vh - var(--sticky-top)); overflow-y:auto;
}
.sidebar-header{ padding:12px; background:#f8f9fa; border-bottom:1px solid #e5e7eb; text-align:center; }
.logo-title{ font-weight:800; font-size:1.1rem; color:#0d47a1; letter-spacing:.02em; }

.tree{ display:flex; flex-direction:column; gap:4px; margin:8px 0; }
.tree-group{ margin-top:2px; }
.tree-children{
  list-style:none; margin:4px 0 6px 14px; padding:0 0 0 10px;
  border-left:1px dashed rgba(0,0,0,.12); display:flex; flex-direction:column; gap:2px;
}
.tree-children[hidden]{ display:none !important; }

.tree-node, .tree-leaf{
  appearance:none; border:none; background:transparent; cursor:pointer; width:100%; text-align:left; color:#0f172a;
  padding:6px 8px 6px 6px; display:flex; align-items:center; gap:8px; border-radius:6px;
  transition: color .15s ease, background .15s ease;
}
.tree-node:hover, .tree-leaf:hover{ background:rgba(0,0,0,.03); color:#0b1220; }
.tree-node:focus-visible, .tree-leaf:focus-visible{ outline:2px solid var(--ring); outline-offset:2px; }

.tree-leaf.is-active, .tree-node.is-active{
  background:#e0f7ec; box-shadow: inset 0 0 0 2px rgba(16,185,129,.5); font-weight:700; position:relative;
}
.tree-node.is-partial::after{
  content:""; position:absolute; left:-6px; top:50%; transform:translateY(-50%);
  width:6px; height:2px; border-radius:2px; background:var(--section-color); opacity:.7;
}

.tree-check{ margin-right:6px; accent-color:#10b981; cursor:pointer; width:16px; height:16px; }
.chev{ width:14px; display:inline-block; transform-origin:center; opacity:.6; }
.tree-node[aria-expanded="false"] .chev{ transform:rotate(-90deg); }

/* Badges à droite */
.tree .badge{
  margin-left:auto; padding:4px 8px; border-radius:999px; font-size:.75rem; font-weight:800; line-height:1;
  background:#f1f5f9; color:#0f172a; border:1px solid var(--border);
}
.tree-node.is-active .badge{
  background:#10b981; color:#fff; border-color:rgba(16,185,129,.55);
}

/* Mobile : hamburger & overlay */
.hamburger{ display:none; width:38px; height:34px; border:none; background:transparent; border-radius:8px; align-items:center; justify-content:center; gap:5px; padding:0 6px; cursor:pointer; }
.hamburger span{ display:block; width:22px; height:2px; background:#0f172a; border-radius:2px; }
.side-overlay{ display:none; }
@media (max-width:960px){
  .hamburger{ display:flex; }
  #sidebar{ position:fixed; top:0; left:0; bottom:0; width:82%; max-width:320px; background:#fff; z-index:50; transform:translateX(-100%); transition: transform .2s ease; }
  body.menu-open #sidebar{ transform:translateX(0); }
  .side-overlay{ position:fixed; inset:0; background:rgba(16,24,40,.28); backdrop-filter:blur(2px); z-index:40; }
  body.menu-open .side-overlay{ display:block; }
  .side-overlay[hidden]{ display:none; }
}

/* =========================
   6) Filtres pro (discrets) — #energy-filters
   ========================= */
#energy-filters,
#energy-filters fieldset,
#energy-filters .filter-card{
  background:transparent !important; border:0 !important; box-shadow:none !important;
  padding:0; margin:6px 0 14px;
}
#energy-filters{
  display:flex; align-items:center; flex-wrap:wrap;
  gap:10px 14px; font-size:14px;
}
#energy-filters > div:not(:first-child),
#energy-filters > fieldset:not(:first-child){
  position:relative; padding-left:12px;
}
#energy-filters > div:not(:first-child)::before,
#energy-filters > fieldset:not(:first-child)::before{
  content:""; position:absolute; left:0; top:50%; width:1px; height:14px; background:var(--hairline); transform:translateY(-50%);
}

/* Libellés sobres */
#energy-filters .f-label{ opacity:.65; font-weight:500; margin-right:2px; }

/* Radios “ghost” (norme / benchmark) */
#energy-filters input[name="norm-energy"],
#energy-filters input[name="bench-type-energy"]{
  position:absolute; inline-size:1px; block-size:1px; opacity:0; pointer-events:none;
}
#energy-filters input[name="norm-energy"] + label,
#energy-filters input[name="bench-type-energy"] + label{
  cursor:pointer; padding:2px 0; background:none; border:0; color:var(--txt-2);
  font-weight:500; transition: color .15s ease;
}
#energy-filters input[name="norm-energy"] + label:hover,
#energy-filters input[name="bench-type-energy"] + label:hover{ color:var(--txt-1); }
#energy-filters input[name="norm-energy"]:focus + label,
#energy-filters input[name="bench-type-energy"]:focus + label{
  outline:2px solid var(--section-color); outline-offset:2px; border-radius:3px;
}
#energy-filters input[name="norm-energy"]:checked + label,
#energy-filters input[name="bench-type-energy"]:checked + label{
  color:var(--txt-1); font-weight:600;
}
#energy-filters input[name="norm-energy"]:checked + label::after,
#energy-filters input[name="bench-type-energy"]:checked + label::after{
  content:""; display:block; height:2px; border-radius:2px; background:var(--section-color);
}

/* Toggle climat (compact) */
#energy-filters .ios-switch{ transform:scale(.9); transform-origin:left center; filter:saturate(.9); }
#energy-filters .ios-text{ font-size:.9rem; opacity:.7; }
#energy-filters #toggle-climate{ accent-color:var(--section-color); }

/* =========================
   7) Barre de recherche (sidebar)
   ========================= */
.side-search{ padding:12px; background:#fff; border-bottom:1px solid rgba(0,0,0,.05); }
.search-input{
  display:flex; align-items:center; gap:8px;
  border:1px solid var(--border); background:#fff; border-radius:10px; padding:6px 8px;
}
.search-input:focus-within{ box-shadow:0 0 0 6px var(--ring); }
.search-input input{
  appearance:none; border:none; outline:none; width:100%;
  font-size:.95rem; font-weight:600; color:#0f172a; background:transparent;
}
.s-ico{ opacity:.6; display:inline-flex; }
.s-clear{
  border:none; background:#f1f5f9; color:#0f172a; border-radius:8px; padding:2px 6px; cursor:pointer;
  font-weight:700; line-height:1;
}
.s-clear:hover{ background:#e2e8f0; }
.s-meta{ margin-top:6px; font-size:.8rem; color:#64748b; }
/* retirer la croix native */
.search-input input::-webkit-search-cancel-button{ -webkit-appearance:none; appearance:none; display:none; }
.search-input input::-ms-clear{ display:none; width:0; height:0; }

/* =========================
   8) Accessibilité & utilitaires
   ========================= */
.sr-only{
  position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden;
  clip:rect(0,0,0,0); white-space:nowrap; border:0;
}
@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
}
