#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

const ROOT = __dirname;
const INPUT_FILE = path.join(ROOT, 'Buildings.json');
const OUTPUT_FILE = path.join(ROOT, 'buildings-data.js');
const GENERATED_HEADER = [
  '// This file is auto-generated by generate-buildings-data.js.',
  '// Do not edit it manually â€” update Buildings.json instead.',
  '',
].join('\n');

function main() {
  let data;
  try {
    const jsonContent = fs.readFileSync(INPUT_FILE, 'utf8');
    data = JSON.parse(jsonContent);
  } catch (error) {
    console.error(`Failed to read or parse ${INPUT_FILE}:`, error.message);
    process.exit(1);
  }

  const jsContent = `${GENERATED_HEADER}window.STRATOS_BUILDINGS = ${JSON.stringify(data, null, 2)};\n`;

  try {
    fs.writeFileSync(OUTPUT_FILE, jsContent, 'utf8');
    console.log(`Generated ${path.relative(ROOT, OUTPUT_FILE)} from ${path.relative(ROOT, INPUT_FILE)}.`);
  } catch (error) {
    console.error(`Failed to write ${OUTPUT_FILE}:`, error.message);
    process.exit(1);
  }
}

if (require.main === module) {
  main();
}
