:root{
  --sticky-top: 60px;   /* garde tes autres usages éventuels */
  --sidebar-top: 0px;   /* spécifique sidebar */
  --bg:#f6f7f9; --card:#ffffff; --ink:#101828; --muted:#667085; --border:#e5e7eb; --ring: rgba(76,132,255,.35);
  --section-color:#94a3b8;
  --sticky-top: 60px;
  /* sections */
  --sec-energie:#60a5fa; --sec-travaux:#b45309; --sec-financier:#facc15; --sec-etat:#10b981;
  /* états KPI */
  --kpi-good:#16a34a; --kpi-warn:#f59e0b; --kpi-bad:#ef4444;
  /* largeurs (priorité au bas) */
  --container-max: 1600px;
  --content-max:   1520px;
}

*{box-sizing:border-box}
body{background:var(--bg); color:var(--ink); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; overflow-x:hidden;}

/* ======= KPI cards ======= */
.kpi-wrap{max-width:1200px; margin:24px auto; padding:0 16px}
.kpi-tabs{display:grid; grid-template-columns:repeat(6,minmax(170px,1fr)); gap:12px; align-items:stretch}

.kpi{
  --status:#8a8a8a; --tint:rgba(0,0,0,.04);
  position:relative; display:grid; grid-template-rows:auto auto 1fr auto; gap:6px; padding:16px; border-radius:16px;
  background:var(--card); border:1px solid var(--border); cursor:pointer; text-align:center; justify-items:center;
  transition:transform .14s ease, box-shadow .14s ease, border-color .14s ease;
  box-shadow:0 1px 0 rgba(0,0,0,.02), 0 8px 24px rgba(16,24,40,.06);
}
.kpi[data-status="good"]{--status:#16a34a; --tint:rgba(22,163,74,.12)}
.kpi[data-status="warn"]{--status:#f59e0b; --tint:rgba(245,158,11,.14)}
.kpi[data-status="bad"]{--status:#ef4444; --tint:rgba(239,68,68,.12)}

.kpi-label{font-size:1.05rem; font-weight:700; letter-spacing:.01em; color:#1f2937; min-height:1.6rem}
.kpi-title{font-size:.95rem; margin-top:2px; color:#334155; min-height:2.0rem}
.kpi-value-wrap{position:relative; width:100%; height:2.6rem; padding-inline: calc(var(--trend-w, 0px) + 8px);}
.kpi-value{position:absolute; left:50%; transform:translateX(-50%); font-size:2rem; font-weight:800; line-height:2.6rem; margin:0; font-variant-numeric: tabular-nums; letter-spacing:-0.01em; color:var(--status); width: calc(var(--value-ch, 6) * 1ch); text-align:center;}
.kpi-trend{position:absolute; right:0; top:50%; transform:translateY(-50%); font-size:.75rem; font-weight:700; white-space:nowrap;}
.trend-up{color:#ef4444}
.trend-down{color:#16a34a}
@keyframes up2{0%{transform:translateY(0)}35%{transform:translateY(-4px)}55%{transform:translateY(0)}75%{transform:translateY(-2px)}100%{transform:translateY(0)}}
@keyframes down2{0%{transform:translateY(0)}35%{transform:translateY(4px)}55%{transform:translateY(0)}75%{transform:translateY(2px)}100%{transform:translateY(0)}}
.arr{display:inline-block;} .animate-up{animation:up2 .9s ease-out both;} .animate-down{animation:down2 .9s ease-out both;}
.kpi-unit{font-size:.85rem; color:var(--muted); min-height:1.4rem}

.kpi:focus-visible{outline:none; box-shadow:0 0 0 6px var(--ring)}
.kpi[aria-selected="true"]{transform:translateY(-4px) scale(1.02); border-color:#cbd5e1; box-shadow:0 10px 28px rgba(16,24,40,.14), 0 0 0 2px var(--status) inset;}
.kpi[aria-selected="true"] .kpi-icon{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; background:var(--tint); color:var(--status);}
.kpi-dot{position:absolute; top:10px; right:10px; width:14px; height:14px; border-radius:999px; background:var(--status); box-shadow:0 0 0 4px var(--tint), 0 0 0 1px rgba(0,0,0,.08) inset, 0 0 4px var(--status), 0 0 10px var(--status);}
.kpi[aria-selected="true"] .kpi-dot{box-shadow:0 0 0 6px var(--tint), 0 0 0 2px var(--status) inset, 0 0 6px var(--status), 0 0 14px var(--status);}
.kpi[aria-selected="true"] .kpi-title{color:#111827;}

.kpi-head{display:flex; align-items:center; justify-content:center; gap:8px}
.kpi-icon{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; background:var(--tint); color:var(--status);}

.kpi:not([aria-selected="true"]) {opacity:.78; filter:saturate(.9)}
.kpi:hover{transform:translateY(-2px)}
@media (max-width: 1100px){ .kpi-tabs{grid-template-columns:repeat(3,1fr)} }
@media (max-width: 640px){ .kpi-tabs{grid-template-columns:1fr 1fr} .kpi{padding:12px} .kpi-value{font-size:1.6rem} }

.panel-summary{display:flex; flex-wrap:wrap; gap:10px 12px; margin:6px 0 12px}
.pill{display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#f8fafc; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(16,24,40,.04)}
.pill-ico svg{display:block}
.pill-label{font-size:.85rem; color:#64748b}
.pill-value{font-size:1.05rem; font-weight:800; letter-spacing:-0.01em; font-variant-numeric: tabular-nums}
.pill-unit{font-size:.8rem; color:#94a3b8; margin-left:2px}

/* ======= Top nav ======= */
.top-nav{
  position: relative; z-index: 1000; display:flex; gap:20px; margin:0 0 24px; padding:0 0 6px;
  border:none; border-radius:0; background:transparent; box-shadow:none; border-bottom:1px solid rgba(0,0,0,.05);
  align-items:center; flex-wrap:wrap; width:100%; justify-content:flex-start; overflow:visible;
}
.top-item{
  appearance:none; border:none; background:transparent; color:#0f172a;
  /* échelle locale, 1 par défaut */
  --top-scale: 1;
  padding: calc(8px * var(--top-scale)) calc(6px * var(--top-scale));
  border-radius:0; font-weight:700; font-size: calc(.95rem * var(--top-scale));
  cursor:pointer; display:flex; align-items:center; gap: calc(8px * var(--top-scale));
  position:relative;
}
.top-nav > .top-item:nth-of-type(2),
.top-nav > .top-item:nth-child(2),
.top-nav > *:nth-child(2) .top-item,
.top-nav > .top-item:nth-of-type(3),
.top-nav > .top-item:nth-child(3),
.top-nav > *:nth-child(3) .top-item,
.top-nav > .top-item:nth-of-type(4),
.top-nav > .top-item:nth-child(4),
.top-nav > *:nth-child(4) .top-item,
.top-nav > .top-item:nth-of-type(5),
.top-nav > .top-item:nth-child(5),
.top-nav > *:nth-child(5) .top-item{
  --top-scale: 1.2;
}

.top-item:focus-visible{outline:none; box-shadow:0 0 0 6px var(--ring)}
.top-item.is-active::after{
  content:""; position:absolute; left:0; right:0; bottom:-10px; height:3px; border-radius:2px; background:var(--section-color, #60a5fa);
}
.top-item:hover{opacity:.9}
.top-item.is-active{color:#0f172a}
@media (max-width:640px){ .top-nav{flex-wrap:nowrap; gap:14px; margin-bottom:16px} }

.section{margin-top:18px}
.section[hidden]{display:none}

/* Panels */
.kpi-panels{margin-top:18px; background:transparent; border:none; border-radius:16px; padding:16px 0 0; box-shadow:none}
.kpi-panels section[hidden]{display:none}
.kpi-panels h3{margin:.2rem 0 .4rem 0}
.meter{height:10px; background:#eef2f6; border-radius:8px; overflow:hidden; border:1px solid var(--border)}
.meter > div{height:100%; width:0; background:var(--active-color, #94a3b8)}

.energy-trend-chart{
  margin-top:20px;
  padding:18px 20px 16px;
  border:1px solid var(--border);
  border-radius:16px;
  background:linear-gradient(180deg, rgba(99,102,241,0.08), rgba(99,102,241,0));
  box-shadow:0 6px 16px rgba(15,23,42,0.06);
  position:relative;
}
.chart-title{display:flex; flex-direction:column; align-items:flex-start; gap:6px; font-weight:700; color:#1f2937; padding-right:64px}
.chart-unit{font-size:.9rem; color:#475569; font-weight:600}
.chart-bars{
  --bar-scale:0.7px;
  display:flex;
  align-items:flex-end;
  gap:18px;
  margin-top:16px;
  padding:8px 0 0;
  min-height:160px;
}
.chart-bar{flex:1; display:flex; flex-direction:column; align-items:center; gap:8px; font-variant-numeric:tabular-nums; color:#0f172a}
.chart-bar .bar-value{font-weight:700; font-size:1rem}
.chart-bar .bar-fill{
  width:100%;
  height:calc(var(--value) * var(--bar-scale));
  background:linear-gradient(180deg, #4f46e5, #6366f1);
  border-radius:10px 10px 6px 6px;
  box-shadow:0 6px 14px rgba(79,70,229,0.25);
}
.chart-bar.is-selected .bar-fill{
  background:linear-gradient(180deg, #f97316, #fb923c);
  box-shadow:0 6px 16px rgba(249,115,22,0.3);
}
.chart-bar.is-selected .bar-value{color:#f97316;}
.chart-bar .bar-year{font-size:.85rem; color:#475569; letter-spacing:.02em}
.energy-trend-chart figcaption{margin-top:12px; font-size:.85rem; color:#475569; text-align:center}

.energy-chart-zone{
  display:flex;
  align-items:flex-start;
  gap:24px;
  flex-wrap:wrap;
  position:relative;
  --catalog-open-translate-x: calc(-100% + 64px);
  --catalog-open-translate-y: 34px;
  --catalog-open-scale: 1;
  --catalog-closed-scale: .72;
  --catalog-slide-x: 28px;
  --catalog-slide-y: -34px;
  --catalog-origin-x: calc(100% - 32px);
  --catalog-origin-y: 42px;
  --catalog-toggle-clearance: 64px;
}
.energy-chart-wrapper{position:relative; flex:1 1 420px; min-width:0}
.chart-edit-toggle{
  position:absolute;
  top:16px;
  right:16px;
  width:42px;
  height:42px;
  border-radius:50%;
  border:1px solid var(--border);
  background:#fff;
  color:#475569;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:12;
  box-shadow:0 12px 28px rgba(15,23,42,0.12);
  --catalog-toggle-shift-x: 0px;
  --catalog-toggle-shift-y: 0px;
  transform:translate3d(var(--catalog-toggle-shift-x), var(--catalog-toggle-shift-y), 0);
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, color .18s ease;
}
.chart-edit-toggle:hover{
  transform:translate3d(var(--catalog-toggle-shift-x), calc(var(--catalog-toggle-shift-y) - 2px), 0);
  box-shadow:0 16px 32px rgba(59,130,246,0.25);
  border-color:#c7d2fe;
  color:#1d4ed8;
}
.chart-edit-toggle:focus-visible{outline:none; box-shadow:0 0 0 4px var(--ring)}
.chart-edit-toggle::after{
  content:"";
  position:absolute;
  inset:-6px;
  border-radius:inherit;
  background:radial-gradient(circle at 50% 50%, rgba(59,130,246,0.24), rgba(59,130,246,0));
  opacity:0;
  transition:opacity .24s ease;
  pointer-events:none;
}
.energy-chart-zone.catalog-open .chart-edit-toggle{
  color:#1d4ed8;
  border-color:#93c5fd;
  box-shadow:0 20px 36px rgba(59,130,246,0.28);
}
.energy-chart-zone.catalog-open .chart-edit-toggle::after{opacity:1}
.chart-edit-toggle.is-in-catalog{
  background:linear-gradient(135deg, rgba(219,234,254,0.8), rgba(219,234,254,0.2));
}

.chart-catalog{
  position:absolute;
  top:0;
  right:0;
  display:flex;
  flex-direction:column;
  gap:16px;
  padding:calc(24px + var(--catalog-toggle-clearance)) 20px 24px;
  border-radius:18px;
  border:1px solid var(--border);
  background:#fff;
  box-shadow:0 20px 40px rgba(15,23,42,0.16);
  opacity:0;
  transform-origin: var(--catalog-origin-x) var(--catalog-origin-y);
  transform:translate3d(calc(var(--catalog-open-translate-x) + var(--catalog-slide-x)), calc(var(--catalog-open-translate-y) + var(--catalog-slide-y)), 0) scale(var(--catalog-closed-scale));
  transition:opacity .28s ease, transform .44s cubic-bezier(0.22, 1, 0.36, 1);
  pointer-events:none;
  will-change:transform, opacity;
  min-height:280px;
  width:min(320px, calc(100% - 32px));
  max-width:340px;
  z-index:10;
}
.chart-catalog[hidden]{display:none !important}
.energy-chart-zone.catalog-open .chart-catalog{
  opacity:1;
  transform:translate3d(var(--catalog-open-translate-x), var(--catalog-open-translate-y), 0) scale(var(--catalog-open-scale));
  pointer-events:auto;
}

.catalog-header{display:flex; align-items:center; justify-content:flex-start; gap:12px}
.catalog-title{display:flex; align-items:center; gap:10px; font-weight:700; color:#0f172a}
.catalog-title h4{margin:0; font-size:1.05rem}
.catalog-icon{display:inline-flex; align-items:center; justify-content:center; width:34px; height:34px; border-radius:10px; background:rgba(59,130,246,0.08); color:#2563eb}
.catalog-intro{margin:0; font-size:.85rem; color:#475569; line-height:1.4}
.catalog-list{list-style:none; margin:0; padding:0; display:grid; gap:12px}
.catalog-card{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid #e0e7ff;
  background:linear-gradient(135deg, rgba(79,70,229,0.08), rgba(79,70,229,0));
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:6px;
  cursor:pointer;
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  color:#1e293b;
}
.catalog-card:hover{transform:translateY(-2px); box-shadow:0 16px 28px rgba(99,102,241,0.22); border-color:#c4b5fd}
.catalog-card:focus-visible{outline:none; box-shadow:0 0 0 4px var(--ring)}
.card-label{font-weight:700; font-size:.95rem}
.card-meta{font-size:.78rem; color:#64748b}
.catalog-footer{margin-top:auto}
.catalog-action{
  width:100%;
  border:none;
  border-radius:999px;
  padding:10px 16px;
  font-weight:600;
  background:linear-gradient(135deg, #2563eb, #4f46e5);
  color:#fff;
  cursor:pointer;
  transition:transform .18s ease, box-shadow .18s ease, filter .18s ease;
}
.catalog-action:hover{transform:translateY(-1px); box-shadow:0 16px 32px rgba(37,99,235,0.28); filter:brightness(1.02)}
.catalog-action:focus-visible{outline:none; box-shadow:0 0 0 4px var(--ring)}

@media (max-width: 960px){
  .energy-chart-zone{flex-direction:column; align-items:stretch}
  .chart-edit-toggle{right:16px; top:16px}
  .chart-catalog{
    left:50%;
    right:auto;
    top:12px;
    width:min(480px, calc(100% - 32px));
  }
  .energy-chart-zone{
    --catalog-open-translate-x: -50%;
    --catalog-open-translate-y: 0px;
    --catalog-origin-x: 50%;
    --catalog-origin-y: 24px;
    --catalog-toggle-clearance: 40px;
  }
}
@media (max-width: 640px){
  .chart-title{padding-right:56px}
  .chart-edit-toggle{top:12px; right:12px; width:38px; height:38px}
  .energy-chart-zone{--catalog-toggle-clearance: 36px;}
  .catalog-header{align-items:flex-start}
}

@media (prefers-reduced-motion: reduce){
  .energy-chart-zone{--catalog-closed-scale: 1; --catalog-slide-x: 0px; --catalog-slide-y: 0px;}
  .chart-catalog{transition:opacity .2s ease; transform:none;}
  .energy-chart-zone.catalog-open .chart-catalog{transform:none;}
  .energy-chart-zone.catalog-open .chart-edit-toggle{transform:none;}
}


.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Chevron hint */
.kpi-chevron{position:absolute; left:50%; bottom:-16px; transform:translateX(-50%); display:none; opacity:.95; pointer-events:none; z-index:2}
.kpi[aria-selected="true"] .kpi-chevron{display:inline-flex; animation:chev 1.4s ease-in-out infinite; color: var(--status)}
@keyframes chev{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(6px)}}

/* Sticky header in panel */
.panel-sticky{pointer-events:none; position:sticky; top:0; display:flex; align-items:center; gap:10px; padding:12px 16px; background:#fff; z-index:10; transition:opacity .25s ease, transform .25s ease; opacity:1; transform:translateY(0); border-top-left-radius:14px; border-top-right-radius:14px;}
.ps-icon svg{width:18px; height:18px; display:block}
.ps-label{font-weight:700; color:#111827}
.ps-dot{margin-left:auto; width:12px; height:12px; border-radius:999px; background:var(--active-color, #cbd5e1); position:relative; box-shadow:0 0 4px var(--active-color, #94a3b8), 0 0 10px var(--active-color, #94a3b8);}

.panel-box{
  border:2px solid var(--active-color, #cbd5e1); border-radius:16px; background:#fff; padding:16px;
  box-shadow:0 6px 16px rgba(16,24,40,.06); position:relative; width:100%;
}
.panel-sticky.is-idle{opacity:0; transform:translateY(-8px); pointer-events:none}
.panel-top-sentinel{position:absolute; top:0; left:0; width:1px; height:1px; pointer-events:none}

/* Glow animations */
.kpi-dot::after{content:""; position:absolute; inset:-6px; border-radius:inherit; background:radial-gradient(circle at center, var(--status) 14%, rgba(255,255,255,0) 55%); filter:blur(4px); opacity:.35; animation:dot-glow 2.2s ease-in-out infinite}
.kpi[aria-selected="true"] .kpi-dot::after{animation:dot-glow-strong 1.6s ease-in-out infinite; opacity:.5}
@keyframes dot-glow{0%,100%{transform:scale(1); opacity:.32}50%{transform:scale(1.12); opacity:.5}}
@keyframes dot-glow-strong{0%,100%{transform:scale(1.02); opacity:.45}50%{transform:scale(1.18); opacity:.75}}
@media (prefers-reduced-motion: reduce){
  .kpi-dot::after{animation:none; opacity:.4}
  .kpi[aria-selected="true"] .kpi-dot::after{animation:none; opacity:.6}
}
.ps-dot::after{content:""; position:absolute; inset:-6px; border-radius:inherit; background:radial-gradient(circle at center, var(--active-color) 14%, rgba(255,255,255,0) 55%); filter:blur(4px); opacity:.35; animation:dot-glow 2.2s ease-in-out infinite}
.panel-sticky .ps-dot::after{animation:dot-glow-strong 1.6s ease-in-out infinite; opacity:.5}
@media (prefers-reduced-motion: reduce){ .ps-dot::after{animation:none; opacity:.6} }

.ti-ico svg{ width: calc(18px * var(--top-scale)); height: calc(18px * var(--top-scale)); display:block }
.ti-label{white-space:nowrap}

/* === Layout global avec sidebar === */
.app{
  display:grid; grid-template-columns: 260px 1fr; gap:16px;
  max-width: var(--container-max) !important;
  margin:0 auto; padding:12px 12px 24px;
}
.main{ min-width:0; }
@media (max-width: 960px){ .app{ grid-template-columns: 1fr; } .side-nav{ order:-1; } }

/* === Sidebar / Tree (fusion, priorité bas) === */
.side-nav{
  position: sticky; top: var(--sidebar-top); align-self: start;
  background: #fff; border-right: 1px solid #ddd; padding: 0;
  max-height: calc(100vh - var(--sidebar-top)); overflow-y: auto;
}
.tree{ display:flex; flex-direction:column; gap:4px; }
.tree-group{ margin-top:2px; }
.tree-children{
  list-style:none; margin:4px 0 6px 14px; padding:0 0 0 10px;
  border-left: 1px dashed rgba(0,0,0,.12); display:flex; flex-direction:column; gap:2px;
}
.tree-children[hidden]{ display:none !important; }

.tree-node, .tree-leaf{
  appearance:none; border:none; background:transparent; cursor:pointer; width:100%; text-align:left; color:#0f172a;
  padding:6px 8px 6px 6px; display:flex; align-items:center; gap:8px; border-radius:6px; transition: color .15s ease, background .15s ease;
}
.tree-node:hover, .tree-leaf:hover{ background:rgba(0,0,0,.03); color:#0b1220; }

.tree-leaf.is-active,
.tree-node.is-active{
  background: #e0f7ec; box-shadow: inset 0 0 0 2px rgba(16, 185, 129, 0.5); font-weight: 700; position: relative;
}
.tree-node.is-partial::after{
  content:""; position:absolute; left:-6px; top:50%; transform:translateY(-50%);
  width:6px; height:2px; border-radius:2px; background: var(--section-color, #60a5fa); opacity:.7;
}
.tree-check { margin-right: 6px; accent-color: #10b981; cursor: pointer; width: 16px; height: 16px; }
.chev{ width:14px; display:inline-block; transform-origin:center; opacity:.6; }
.tree-node[aria-expanded="false"] .chev{ transform:rotate(-90deg); }

/* Alignement avec les onglets (fusion, priorité bas mais cohérence vars) */
.sidebar-header { padding: 1rem; background: #f8f9fa; text-align: center; border-bottom: 1px solid #ddd; }
.logo-title { font-family: 'Segoe UI', sans-serif; font-weight: 800; font-size: 1.4rem; color: #0d47a1; letter-spacing: 1px; }

/* Hamburger + overlay mobile */
.hamburger{ display:none; width:38px; height:34px; border:none; background:transparent; border-radius:8px; align-items:center; justify-content:center; gap:5px; padding:0 6px; cursor:pointer; }
.hamburger span{ display:block; width:22px; height:2px; background:#0f172a; border-radius:2px; }
@media (max-width: 960px){
  .hamburger{ display:flex; }
  .side-overlay{ position: fixed; inset:0; background: rgba(16,24,40,.28); backdrop-filter: blur(2px); z-index: 40; }
  body.menu-open #sidebar{ transform: translateX(0); }
  body.menu-open .side-overlay{ display:block; }
  .side-overlay[hidden]{ display:none; }
}

/* ===== Mini KPI (sections hors Énergie) ===== */
.kpi-tabs--alt { display:grid; grid-template-columns:repeat(3,minmax(170px,1fr)); gap:12px; }
@media (max-width:1100px){ .kpi-tabs--alt{ grid-template-columns:repeat(3,1fr);} }
@media (max-width:640px){ .kpi-tabs--alt{ grid-template-columns:repeat(2,1fr);} }
.kpi.kpi--alt{ cursor:default; }
.kpi.kpi--alt:hover{ transform:none; }
.kpi.kpi--alt .kpi-chevron{ display:none; }

/* Zone droite dans la barre du haut (fusion) */
.top-right{
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Mobile : évite l’écrasement si la barre ne wrap pas */
@media (max-width: 640px){
  .year-picker{ height: 32px; font-size: .9rem; }
}

/* élargit le conteneur global (sidebar + main) */
.app{ max-width: var(--container-max) !important; }
/* élargit uniquement la “div du milieu” */
.kpi-wrap,
.section .tabset{
  max-width: var(--content-max) !important;
  margin-left: auto;
  margin-right: auto;
}

/* ==== Barre de recherche (sidebar) ==== */
.side-search{
  padding: 12px; background: #fff; border-bottom: 1px solid rgba(0,0,0,.05);
}
.search-input{
  display:flex; align-items:center; gap:8px;
  border:1px solid var(--border); background:#fff; border-radius:10px; padding:6px 8px;
}
.search-input:focus-within{ box-shadow:0 0 0 6px var(--ring); }
.search-input input{
  appearance:none; border:none; outline:none; width:100%;
  font-size:.95rem; font-weight:600; color:#0f172a; background:transparent;
}
.s-ico{ opacity:.6; display:inline-flex; }
.s-clear{ border:none; background:#0f1f59; color:#0f172a; border-radius:8px; padding:2px 6px; cursor:pointer;
  font-weight:700; line-height:1; }
.s-clear:hover{ background:#e2e8f0; }
.s-meta{ margin-top:6px; font-size:.8rem; color:#64748b; }
/* Cache la croix native des champs search (Chrome/Safari/Edge) */
.search-input input::-webkit-search-cancel-button { -webkit-appearance: none; appearance: none; display: none; }
.search-input input::-ms-clear { display: none; width: 0; height: 0; }

/* ==== Pastilles (badges) dans l’arborescence ==== */
.tree .badge{
  margin-left: auto;
  padding: 4px 8px;
  border-radius: 999px;
  font-size: .75rem;
  font-weight: 800;
  line-height: 1;
  letter-spacing: .02em;
  white-space: nowrap;
  background: #f1f5f9;
  color: #0f172a;
  border: 1px solid var(--border);
}
.tree-node:hover .badge,
.tree-leaf:hover .badge{ background:#eef2f7; }
.tree-node.is-active .badge{
  background: #10b981; color: #fff;
  border-color: rgba(16,185,129,.55);
  box-shadow: 0 0 0 1px rgba(255,255,255,.15) inset;
}
@media (max-width: 640px){
  .tree .badge{ padding: 3px 7px; font-size: .72rem; }
}

/* ==== Filtres inline (onglet Énergie) ==== */
.filters-inline{
  margin: 8px 0 12px; padding: 12px;
  background:#fff; border:1px solid var(--border); border-radius:12px;
  box-shadow: 0 2px 8px rgba(16,24,40,.05);
  --ctrl-h: 32px;
  --ctrl-fs: .9rem;
  --ctrl-px: 10px;
}
/* Champs natifs du groupe .filters-inline : plus compacts */
.filters-inline select,
.filters-inline input[type="text"],
.filters-inline input[type="number"],
.filters-inline input[type="search"],
.filters-inline button,
#energy-filters [role="combobox"],
#energy-filters [aria-haspopup="listbox"]{
  height: var(--ctrl-h) !important;
  min-height: var(--ctrl-h) !important;
  padding: 0 var(--ctrl-px) !important;
  font-size: var(--ctrl-fs) !important;
  line-height: calc(var(--ctrl-h) - 2px) !important;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: #fff;
  appearance: none; -webkit-appearance: none;
  box-sizing: border-box;
}

.fi-grid{
  display:grid; gap:12px;
  grid-template-columns: repeat(4, minmax(200px, 1fr));
}
@media (max-width: 1200px){ .fi-grid{ grid-template-columns: repeat(2, minmax(200px, 1fr)); } }
@media (max-width: 640px){  .fi-grid{ grid-template-columns: 1fr; } }

.fi-item{ display:flex; flex-direction:column; gap:8px; }
.fi-label{ font-size:.85rem; font-weight:700; color:#111827; }

/* Était: .year-picker { ... }  -> Devient: */
#year-picker, .year-picker{ position:relative; display:inline-flex; --year-scale: 1.2; }


/* Était: .year-picker .year-btn { ... } -> Devient: */
#year-picker .year-btn,
.year-picker .year-btn{ 
  appearance:none;
  display:inline-flex; align-items:center; gap: calc(8px * var(--year-scale));
  padding: calc(8px * var(--year-scale)) calc(12px * var(--year-scale));
  height: calc(34px * var(--year-scale));
  border-radius:9999px; background:#fff; border:1px solid var(--border);
  box-shadow:0 1px 2px rgba(16,24,40,.05);
  font-weight:700; font-size: calc(.95rem * var(--year-scale));
  line-height:1; color:#0f172a; cursor:pointer;
}

/* Était: .year-picker .year-chev { ... } -> Devient: */
#year-picker .year-chev,
.year-picker .year-chev{
  width: calc(18px * var(--year-scale)); height: calc(18px * var(--year-scale));
  opacity:.7; transition:transform .18s ease;
}

/* Était: .year-picker .year-btn[aria-expanded="true"] .year-chev -> Devient: */
#year-picker .year-btn[aria-expanded="true"] .year-chev,
.year-picker .year-btn[aria-expanded="true"] .year-chev{ transform:rotate(180deg); }

/* Était: .year-picker .year-menu -> Devient: */
#year-picker .year-menu,
.year-picker .year-menu{
  position:absolute; right:0; top:calc(100% + 10px);
  min-width: calc(160px * var(--year-scale));
  max-height:260px; overflow:auto;
  border:1px solid var(--hairline, #e5e7eb);
  background:color-mix(in oklab, white 92%, transparent);
  border-radius:12px; padding:6px; z-index:1000;
  box-shadow:0 8px 24px rgba(0,0,0,.08), 0 4px 10px rgba(0,0,0,.06);
}

#year-picker .year-menu [role="option"],
.year-picker .year-menu [role="option"]{
  display:flex; align-items:center; gap:.5rem;
  padding:6px 8px; border-radius:6px; cursor:pointer;
  user-select:none; white-space:nowrap;
}
#year-picker .year-menu [role="option"].is-active,
#year-picker .year-menu [role="option"]:hover,
.year-picker .year-menu [role="option"].is-active,
.year-picker .year-menu [role="option"]:hover{
  background:color-mix(in oklab, var(--section-color) 12%, transparent);
}
#year-picker .year-menu [role="option"].is-selected,
#year-picker .year-menu [role="option"][aria-selected="true"],
.year-picker .year-menu [role="option"].is-selected,
.year-picker .year-menu [role="option"][aria-selected="true"]{
  font-weight:600;
}

/* petit ajustement mobile si besoin */
@media (max-width: 640px){
  #year-picker, .year-picker{ --year-scale: 1.2; }
  #year-picker .year-btn, .year-picker .year-btn{
    height: calc(32px * var(--year-scale));
    padding: calc(6px * var(--year-scale)) calc(10px * var(--year-scale));
    font-size: calc(.9rem * var(--year-scale));
  }
  #year-picker .year-chev, .year-picker .year-chev{
    width: calc(18px * var(--year-scale)); height: calc(18px * var(--year-scale));
  }
}


/* (optionnel) caler visuellement à droite du header */
.top-right{ display:flex; align-items:center; margin-left:auto; }

/* =========================
   Filtres pro (discrets)
   ========================= */
#energy-filters,
#energy-filters fieldset,
#energy-filters .filter-card {
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  padding: 0;
  margin: 10px 0 28px;   /* ← au lieu de 6px 0 14px */
}

#energy-filters {
  --txt-1: var(--text-color, #0f172a);
  --txt-2: color-mix(in oklab, var(--txt-1) 65%, transparent);
  --hairline: color-mix(in oklab, var(--txt-1) 14%, transparent);
  display: flex; align-items: center; flex-wrap: wrap;
  gap: 10px 14px; font-size: 14px;
  --ctrl-h: 32px;
  --ctrl-fs: .9rem;
  --ctrl-px: 10px;
}
#energy-filters > div:not(:first-child),
#energy-filters > fieldset:not(:first-child) {
  position: relative; padding-left: 12px;
}
#energy-filters > div:not(:first-child)::before,
#energy-filters > fieldset:not(:first-child)::before {
  content: ""; position: absolute; left: 0; top: 50%;
  width: 1px; height: 14px; background: var(--hairline); transform: translateY(-50%);
}
#energy-filters .f-label { opacity: .65; font-weight: 500; margin-right: 2px; }

/* === SegSwitch (pilule sous le texte) — version concise === */
.seg2{
  --h: var(--ctrl-h, 40px);       /* garde ta hauteur pilotée */
  --r:999px; --bg:#f1f5f9; --bd:#e5e7eb; --pill:#fff;
  --txt:#0f172a; --muted:#6b7280; --pad-x: 8px;   /* padding + serré */
  --minw: 0;                                      /* plus de largeur mini */
  position:relative;
  display:inline-grid;                             /* évite l’étirement full ligne */
  grid-template-columns: 1fr 1fr;                  /* moitiés égales pour la pillule */
  align-items:center;
  background:var(--bg); border:1px solid var(--bd); border-radius:var(--r);
  padding:4px;
  height:calc(var(--h) + 8px);
  min-width: var(--minw);
  width: fit-content;                              /* largeur au contenu */
  overflow:hidden;
  -webkit-tap-highlight-color:transparent;
}
.seg2 > input[type="radio"]{ appearance:none; position:absolute; width:0; height:0; margin:0; opacity:0; pointer-events:none; }
.seg2 > label{
  position:relative; z-index:2; display:flex; align-items:center; justify-content:center;
  height:var(--h); padding:0 var(--pad-x); border-radius:var(--r);
  font: 700 var(--ctrl-fs, .95rem)/1 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--muted); cursor:pointer; white-space:nowrap;
}
.seg2 .pill{
  position:absolute; inset:4px auto 4px 4px; width:calc(50% - 4px);
  background:var(--pill); border:1px solid var(--bd); border-radius:var(--r);
  box-shadow:0 1px 2px rgba(16,24,40,.06); z-index:1; pointer-events:none;
  transition:transform .22s ease;
}
.seg2:has(input:last-of-type:checked) .pill{ transform:translateX(100%); }
.seg2:has(input:first-of-type:checked) > label:first-of-type,
.seg2:has(input:last-of-type:checked)  > label:last-of-type{ color:var(--txt); }
.seg2:has(input:focus-visible){ outline:2px solid #cbd5e1; outline-offset:2px; }

/* — reset anciens styles dans les seg2 — */
#energy-filters .seg2 label{ outline:none!important; box-shadow:none!important; padding:0 var(--pad-x)!important; }
#energy-filters .seg2 label::before,
#energy-filters .seg2 label::after{ content:none!important; }

/* mobile */
@media (max-width:640px){ .seg2{ --h:36px; --minw:220px; } .seg2 > label{ font-size:.9rem; } }
/* Bloc filtres (même style que ta sidebar) */
.side-nav .side-filters{ padding:10px 12px; background:#fff; border-bottom:1px solid rgba(0,0,0,.05); }
.side-nav .ms-group{ margin:8px 0 14px; }
.side-nav .ms-label{ font-weight:800; font-size:.9rem; color:#0f172a; margin-bottom:6px; }

/* Composant multi-select */
.ms{ position:relative; }
.ms-btn{
  width:100%; height:32px; padding:0 10px;
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  border:1px solid var(--border); border-radius:10px; background:#fff;
  font-weight:700; font-size:.9rem; color:#0f172a; cursor:pointer;
}
.ms-btn:focus-visible{ outline:none; box-shadow:0 0 0 6px var(--ring); }
.ms-chev{ width:16px; height:16px; opacity:.6; flex:0 0 auto; transition:transform .18s ease; }
.ms[aria-open="true"] .ms-chev{ transform:rotate(180deg); }

.ms-menu{
  position:absolute; left:0; right:0; top:calc(100% + 6px);
  background:#fff; border:1px solid var(--border); border-radius:12px; padding:6px;
  box-shadow:0 8px 24px rgba(0,0,0,.08), 0 4px 10px rgba(0,0,0,.06);
  max-height:220px; overflow:auto; z-index:1000; display:none;
}
.ms[aria-open="true"] .ms-menu{ display:block; }

.ms-option{
  display:flex; align-items:center; gap:8px;
  padding:6px; border-radius:6px; cursor:pointer; user-select:none;
  font-size:.9rem; color:#0f172a;
}
.ms-option:hover{ background:rgba(0,0,0,.03); }
.ms-option input{ width:16px; height:16px; margin:0; accent-color:#10b981; }

/* Bouton Effacer aligné à droite, discret */
.ms-clear{
  margin-top:6px; margin-left:auto; display:inline-block;
  background:transparent; border:none; color:#0b7f5f; font-weight:700; font-size:.8rem; cursor:pointer; padding:2px 4px; border-radius:6px;
}
.ms-clear:hover{ background:rgba(16,185,129,.08); }

/* Compact sur petits écrans si besoin */
@media (max-width:640px){
  .ms-btn{ height:30px; font-size:.88rem; }
  .ms-menu{ max-height:200px; }
}
.filters-toggle-btn {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.3em;
  margin: 1em 0 0.5em 1em;
  padding: 0.3em;
  font-size: 1.1em;
}
#filters-panel[hidden] {
  display: none !important;
}
#filters-panel {
  margin-bottom: 1em;
  padding: 0.5em 1em 0.5em 1em;
  background: #f9fafb;
  border-radius: 12px;
  box-shadow: 0 1px 5px 0 rgba(60,80,110,0.04);
}
