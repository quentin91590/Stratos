:root{
  --bg:#f6f7f9; --card:#ffffff; --ink:#101828; --muted:#667085; --border:#e5e7eb; --ring: rgba(76, 132, 255, .35);
  --section-color:#94a3b8;
}
*{box-sizing:border-box}
body{background:var(--bg); color:var(--ink); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; overflow-x:hidden;}

.kpi-wrap{max-width:1200px; margin:24px auto; padding:0 16px}
.kpi-tabs{display:grid; grid-template-columns:repeat(6,minmax(170px,1fr)); gap:12px; align-items:stretch}

.kpi{
  --status:#8a8a8a; --tint:rgba(0,0,0,.04);
  position:relative; display:grid; grid-template-rows:auto auto 1fr auto; gap:6px; padding:16px; border-radius:16px;
  background:var(--card); border:1px solid var(--border); cursor:pointer; text-align:center; justify-items:center;
  transition:transform .14s ease, box-shadow .14s ease, border-color .14s ease;
  box-shadow:0 1px 0 rgba(0,0,0,.02), 0 8px 24px rgba(16,24,40,.06);
}
.kpi::before{content:""; display:none;}
.kpi[data-status="good"]{--status:#16a34a; --tint:rgba(22,163,74,.12)}
.kpi[data-status="warn"]{--status:#f59e0b; --tint:rgba(245,158,11,.14)}
.kpi[data-status="bad"]{--status:#ef4444; --tint:rgba(239,68,68,.12)}

/* Typo + alignements */
.kpi-label{font-size:1.05rem; font-weight:700; letter-spacing:.01em; color:#1f2937; min-height:1.6rem}
.kpi-title{font-size:.95rem; margin-top:2px; color:#334155; min-height:2.0rem}
.kpi-value-wrap{position:relative; width:100%; height:2.6rem; padding-inline: calc(var(--trend-w, 0px) + 8px);}
.kpi-value{position:absolute; left:50%; transform:translateX(-50%); font-size:2rem; font-weight:800; line-height:2.6rem; margin:0; font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1; letter-spacing:-0.01em; color:var(--status); width: calc(var(--value-ch, 6) * 1ch); text-align:center;}
.kpi-trend{position:absolute; right:0; top:50%; transform:translateY(-50%); font-size:.75rem; font-weight:700; white-space:nowrap;}
.trend-up{color:#ef4444}
.trend-down{color:#16a34a}
@keyframes up2{0%{transform:translateY(0)}35%{transform:translateY(-4px)}55%{transform:translateY(0)}75%{transform:translateY(-2px)}100%{transform:translateY(0)}}
@keyframes down2{0%{transform:translateY(0)}35%{transform:translateY(4px)}55%{transform:translateY(0)}75%{transform:translateY(2px)}100%{transform:translateY(0)}}
.arr{display:inline-block;} .animate-up{animation:up2 .9s ease-out both;} 
.animate-down{animation:down2 .9s ease-out both;} 
.kpi-unit{font-size:.85rem; color:var(--muted); min-height:1.4rem}

.kpi:focus-visible{outline:none; box-shadow:0 0 0 6px var(--ring)}
.kpi[aria-selected="true"]{transform:translateY(-4px) scale(1.02); border-color:#cbd5e1; box-shadow:0 10px 28px rgba(16,24,40,.14), 0 0 0 2px var(--status) inset;}
.kpi[aria-selected="true"] .kpi-icon{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; background:var(--tint); color:var(--status);} 
.kpi-dot{position:absolute; top:10px; right:10px; width:14px; height:14px; border-radius:999px; background:var(--status); box-shadow:0 0 0 4px var(--tint), 0 0 0 1px rgba(0,0,0,.08) inset, 0 0 4px var(--status), 0 0 10px var(--status);}    
.kpi[aria-selected="true"] .kpi-dot{box-shadow:0 0 0 6px var(--tint), 0 0 0 2px var(--status) inset, 0 0 6px var(--status), 0 0 14px var(--status);}  
.kpi[aria-selected="true"] .kpi-title{color:#111827;}

.kpi-head{display:flex; align-items:center; justify-content:center; gap:8px}
.kpi-icon{display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:10px; background:var(--tint); color:var(--status);}

.kpi:not([aria-selected="true"]) {opacity:.78; filter:saturate(.9)}
.kpi:hover{transform:translateY(-2px)}
@media (max-width: 1100px){ .kpi-tabs{grid-template-columns:repeat(3,1fr)} }
@media (max-width: 640px){ .kpi-tabs{grid-template-columns:1fr 1fr} .kpi{padding:12px} .kpi-value{font-size:1.6rem} }

.panel-summary{display:flex; flex-wrap:wrap; gap:10px 12px; margin:6px 0 12px}
.pill{display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#f8fafc; border:1px solid #e5e7eb; box-shadow:0 1px 2px rgba(16,24,40,.04)}
.pill-ico svg{display:block}
.pill-label{font-size:.85rem; color:#64748b}
.pill-value{font-size:1.05rem; font-weight:800; letter-spacing:-0.01em; font-variant-numeric: tabular-nums}
.pill-unit{font-size:.8rem; color:#94a3b8; margin-left:2px}

/* Menu du haut */
.top-nav{
  position: relative;
  z-index: 30;
  display:flex; 
  gap:20px;                     /* + d’espace entre items */
  margin:0 0 24px;              /* + d’air sous le menu */
  padding:0 0 6px;              /* place pour la petite ligne */
  border:none; border-radius:0; background:transparent; box-shadow:none;
  border-bottom:1px solid rgba(0,0,0,.05);  /* liseré doux */
  align-items:center; flex-wrap:wrap; width:100%; justify-content:flex-start; overflow:visible
}
.top-item{
  appearance:none; border:none; background:transparent; color:#0f172a;
  padding:8px 6px; border-radius:0; font-weight:700; font-size:.95rem; cursor:pointer;
  display:flex; align-items:center; gap:8px; position:relative
} 
.top-item:focus-visible{outline:none; box-shadow:0 0 0 6px var(--ring)}
.top-item.is-active::after{
  content:""; position:absolute; left:0; right:0; bottom:-10px;  /* soulignement un peu plus bas */
  height:3px; border-radius:2px; background:var(--section-color, #60a5fa)
}  
.top-item:hover{opacity:.9}
.top-item.is-active{color:#0f172a} 
@media (max-width:640px){ .top-nav{flex-wrap:nowrap; gap:14px; margin-bottom:16px} }

.section{margin-top:18px} 
.section[hidden]{display:none}

/* Panels */
.kpi-panels{margin-top:18px; background:transparent; border:none; border-radius:16px; padding:16px 0 0; box-shadow:none}
.kpi-panels section[hidden]{display:none}
.kpi-panels h3{margin:.2rem 0 .4rem 0}
.meter{height:10px; background:#eef2f6; border-radius:8px; overflow:hidden; border:1px solid var(--border)}
.meter > div{height:100%; width:0; background:var(--active-color, #94a3b8)}

.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Chevron hint for selected tab */
.kpi-chevron{position:absolute; left:50%; bottom:-16px; transform:translateX(-50%); display:none; opacity:.95; pointer-events:none; z-index:2}
.kpi[aria-selected="true"] .kpi-chevron{display:inline-flex; animation:chev 1.4s ease-in-out infinite; color: var(--status)}
@keyframes chev{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(6px)}}

/* Sticky header in panel */
.panel-sticky{position:sticky; top:0; display:flex; align-items:center; gap:10px; padding:12px 16px; background:#fff; z-index:10; transition:opacity .25s ease, transform .25s ease; opacity:1; transform:translateY(0); border-top-left-radius:14px; border-top-right-radius:14px;}
.ps-icon svg{width:18px; height:18px; display:block}
.ps-label{font-weight:700; color:#111827}
.ps-dot{margin-left:auto; width:12px; height:12px; border-radius:999px; background:var(--active-color, #cbd5e1); position:relative; box-shadow:0 0 4px var(--active-color, #94a3b8), 0 0 10px var(--active-color, #94a3b8);}

.panel-box{
  border:2px solid var(--active-color, #cbd5e1); border-radius:16px; background:#fff; padding:16px;
  box-shadow:0 6px 16px rgba(16,24,40,.06); position:relative; width:100%;
}
.panel-sticky.is-idle{opacity:0; transform:translateY(-8px); pointer-events:none}
.panel-top-sentinel{position:absolute; top:0; left:0; width:1px; height:1px; pointer-events:none}

/* Glow animations (tab dot + header dot) */
.kpi-dot::after{content:""; position:absolute; inset:-6px; border-radius:inherit; background:radial-gradient(circle at center, var(--status) 14%, rgba(255,255,255,0) 55%); filter:blur(4px); opacity:.35; animation:dot-glow 2.2s ease-in-out infinite; will-change:transform, opacity}
.kpi[aria-selected="true"] .kpi-dot::after{animation:dot-glow-strong 1.6s ease-in-out infinite; opacity:.5}
@keyframes dot-glow{0%,100%{transform:scale(1); opacity:.32}50%{transform:scale(1.12); opacity:.5}}
@keyframes dot-glow-strong{0%,100%{transform:scale(1.02); opacity:.45}50%{transform:scale(1.18); opacity:.75}}
@media (prefers-reduced-motion: reduce){
  .kpi-dot::after{animation:none; opacity:.4}
  .kpi[aria-selected="true"] .kpi-dot::after{animation:none; opacity:.6}
}
.ps-dot::after{content:""; position:absolute; inset:-6px; border-radius:inherit; background:radial-gradient(circle at center, var(--active-color) 14%, rgba(255,255,255,0) 55%); filter:blur(4px); opacity:.35; animation:dot-glow 2.2s ease-in-out infinite; will-change:transform, opacity}
.panel-sticky .ps-dot::after{animation:dot-glow-strong 1.6s ease-in-out infinite; opacity:.5}
@media (prefers-reduced-motion: reduce){
  .ps-dot::after{animation:none; opacity:.6}
}

.ti-ico svg{width:18px; height:18px; display:block}
.ti-label{white-space:nowrap}
/* === Layout global avec sidebar === */
.app{
  display:grid;
  grid-template-columns: 260px 1fr;
  gap:16px;
  max-width:1280px;
  margin:0 auto;
  padding:12px 12px 24px;
}
.main{ min-width:0; }
@media (max-width: 960px){
  .app{ grid-template-columns: 1fr; }
  .side-nav{ order:-1; }
}

/* === Sidebar / Tree === */
/* --- Sidebar : collée à gauche, liseré droit --- */
.side-nav{
  position: sticky;
  top: 0;
  align-self: start;
  background: transparent;
  border: none;
  border-right: 1px solid rgba(0,0,0,.05);
  padding-right: 12px;
  max-height: 100vh;
  overflow-y: auto;
}

/* --- Arborescence : sans “cartes”, plus élégante --- */
.tree{ display:flex; flex-direction:column; gap:4px; }
.tree-group{ margin-top:2px; }

/* sous-listes avec filet d’indentation */
.tree-children{
  list-style:none; margin:4px 0 6px 14px; padding:0 0 0 10px;
  border-left: 1px dashed rgba(0,0,0,.12);
  display:flex; flex-direction:column; gap:2px;
}
.tree-children[hidden]{ display:none !important; }

/* items “nus” (pas d’encadré) */
.tree-node, .tree-leaf{
  appearance:none; border:none; background:transparent; cursor:pointer;
  width:100%; text-align:left; color:#0f172a;
  padding:6px 8px 6px 6px;
  display:flex; align-items:center; gap:8px;
  border-radius:6px; transition: color .15s ease, background .15s ease;
}

/* accent à gauche au survol/actif, sans encadré */
.tree-node::before, .tree-leaf::before{
  content:""; width:3px; height:0; background:var(--section-color, #60a5fa);
  border-radius:2px; margin-right:6px; transition:height .15s ease;
}
.tree-node:hover, .tree-leaf:hover{ background:rgba(0,0,0,.03); color:#0b1220; }
.tree-node:hover::before, .tree-leaf:hover::before{ height:14px; }

/* états */
.tree-leaf.is-active{
  color:#0b1220; font-weight:700;
}
.tree-leaf.is-active::before{ height:16px; }

/* chevron + icônes minimalistes */
.chev{ width:14px; display:inline-block; transform-origin:center; opacity:.6; }
.tree-node[aria-expanded="false"] .chev{ transform:rotate(-90deg); }
.node-ico{ width:16px; height:16px; display:inline-grid; place-items:center; opacity:.85; }
.tree-leaf .dot{ width:6px; height:6px; border-radius:999px; background:#94a3b8; display:inline-block; }

/* --- Layout global : sidebar à gauche en desktop --- */
.app{
  display:grid;
  grid-template-columns: 260px 1fr;
  gap:16px; max-width:1280px; margin:0 auto; padding:12px 12px 24px;
}
.main{ min-width:0; }

/* --- Hamburger --- */
.hamburger{
  display:none; /* visible seulement en mobile */
  width:38px; height:34px; border:none; background:transparent; border-radius:8px;
  align-items:center; justify-content:center; gap:5px; padding:0 6px; cursor:pointer;
}
.hamburger span{
  display:block; width:22px; height:2px; background:#0f172a; border-radius:2px;
}

/* --- Mobile : sidebar en panneau coulissant gauche --- */
@media (max-width: 960px){
  .app{ grid-template-columns: 1fr; }

  .side-nav{
    position: fixed;
    inset: 0 auto 0 0;          /* top:0; right:auto; bottom:0; left:0 */
    width: 80vw; max-width: 280px;
    background: #ffffff;        /* fond pour la lisibilité en off-canvas */
    border-right: 1px solid rgba(0,0,0,.08);
    padding: 12px;
    transform: translateX(-100%);
    transition: transform .2s ease-out;
    z-index: 50;
  }

  .hamburger{ display:flex; }

  .side-overlay{
    position: fixed; inset:0; background: rgba(16,24,40,.28);
    backdrop-filter: blur(2px);
    z-index: 40;
  }

  /* état ouvert : ajouté sur <body> */
  body.menu-open #sidebar{ transform: translateX(0); }
  body.menu-open .side-overlay{ display:block; }
  .side-overlay[hidden]{ display:none; }
}