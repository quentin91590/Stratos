/* =========================
   Tokens & base
   ========================= */
:root{
  --bg:#f7f8fa; --card:#fff; --ink:#0f172a; --muted:#667085; --border:#e5e7eb; --ring:rgba(76,132,255,.35);
  --section-color:#94a3b8; --sec-energie:#60a5fa; --sec-travaux:#b45309; --sec-financier:#facc15; --sec-etat:#10b981;
  --kpi-good:#16a34a; --kpi-warn:#f59e0b; --kpi-bad:#ef4444;
  --sticky-top:60px; --container-max:1280px; --content-max:1180px;
  --hairline: color-mix(in srgb, var(--ink) 12%, transparent);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font: 14px/1.45 Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
img,svg{display:block;max-width:100%}

/* =========================
   Layout
   ========================= */
.app{
  display:grid; grid-template-columns:260px 1fr; gap:16px;
  max-width:var(--container-max); margin:0 auto; padding:12px;
}
.main{min-width:0}
@media (max-width:960px){ .app{grid-template-columns:1fr} .side-nav{order:-1} }

/* =========================
   Top nav
   ========================= */
.top-nav{
  display:flex; gap:16px; align-items:center; flex-wrap:wrap;
  margin:0 0 16px; padding-bottom:6px; border-bottom:1px solid rgba(0,0,0,.06);
}
.top-item{
  appearance:none; border:0; background:transparent; cursor:pointer;
  padding:6px 4px; font-weight:700; color:#0f172a; position:relative;
}
.top-item:hover{opacity:.9}
.top-item:focus-visible{outline:0; box-shadow:0 0 0 6px var(--ring); border-radius:6px}
.top-item.is-active::after{
  content:""; position:absolute; left:0; right:0; bottom:-7px; height:2px; border-radius:2px;
  background:var(--section-color);
}
.top-right{margin-left:auto; display:flex; align-items:center; gap:10px}

/* =========================
   Year picker (#year-picker)
   ========================= */
#year-picker{position:relative; display:inline-flex}
#year-picker .year-btn{
  display:flex; align-items:center; gap:.5rem; cursor:pointer;
  padding:.4rem .75rem; border-radius:9999px; background:#fff; border:1px solid var(--border);
  font-weight:700;
}
#year-picker .year-btn:focus-visible{outline:2px solid var(--section-color); outline-offset:2px}
#year-picker .chev{width:16px; height:16px; opacity:.6; transition:transform .18s}
#year-picker .year-btn[aria-expanded="true"] .chev{transform:rotate(180deg)}
#year-picker .year-menu{
  position:absolute; right:0; top:calc(100% + 6px); z-index:10;
  min-width:160px; max-height:240px; overflow:auto;
  background:#fff; border:1px solid var(--hairline); border-radius:10px; padding:4px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
}
#year-picker .year-menu [role="option"]{
  padding:6px 8px; border-radius:6px; cursor:pointer; user-select:none; white-space:nowrap;
}
#year-picker .year-menu [role="option"]:hover,
#year-picker .year-menu [role="option"].is-active{background:#f2f5f9}
#year-picker .year-menu [role="option"].is-selected{font-weight:700}

/* =========================
   KPI
   ========================= */
.kpi-wrap{max-width:var(--content-max); margin:16px auto; padding:0 12px}
.kpi-tabs{display:grid; grid-template-columns:repeat(6,minmax(160px,1fr)); gap:10px}
@media (max-width:1100px){.kpi-tabs{grid-template-columns:repeat(3,1fr)}}
@media (max-width:640px){.kpi-tabs{grid-template-columns:1fr 1fr}}

.kpi{
  --status:#8a8a8a; --tint:#f3f4f6;
  display:grid; grid-template-rows:auto auto 1fr auto; gap:6px; justify-items:center; text-align:center;
  padding:14px; border-radius:12px; background:var(--card); border:1px solid var(--border); cursor:pointer;
  transition:transform .12s, border-color .12s;
}
.kpi:hover{transform:translateY(-2px)}
.kpi:focus-visible{outline:0; box-shadow:0 0 0 6px var(--ring)}
.kpi:not([aria-selected="true"]){opacity:.9}

.kpi[data-status="good"]{--status:var(--kpi-good)}
.kpi[data-status="warn"]{--status:var(--kpi-warn)}
.kpi[data-status="bad"] {--status:var(--kpi-bad)}

.kpi-head{display:flex; align-items:center; gap:8px}
.kpi-icon{display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:8px; background:var(--tint); color:var(--status)}
.kpi-label{font-size:1rem; font-weight:800}
.kpi-title{font-size:.92rem; color:#334155; min-height:1.6rem}

.kpi-value-wrap{position:relative; width:100%; height:2.4rem; padding-inline: calc(var(--trend-w,0px) + 6px)}
.kpi-value{
  position:absolute; left:50%; transform:translateX(-50%);
  font-size:1.8rem; font-weight:800; line-height:2.4rem; color:var(--status);
  font-variant-numeric:tabular-nums; letter-spacing:-.01em;
}
.kpi-unit{font-size:.85rem; color:var(--muted)}
.kpi-trend{position:absolute; right:0; top:50%; transform:translateY(-50%); font-size:.75rem; font-weight:700; white-space:nowrap}
.trend-up{color:var(--kpi-bad)}
.trend-down{color:var(--kpi-good)}

.kpi[aria-selected="true"]{
  transform:translateY(-2px);
  border-color:#cbd5e1;
}
.kpi[aria-selected="true"] .kpi-title{color:#111827}

/* Panels */
.section{margin-top:12px}
.section[hidden]{display:none}
.kpi-panels{margin-top:14px}
.kpi-panels section[hidden]{display:none}
.kpi-panels h3{margin:.2rem 0 .4rem 0}
.meter{height:8px; background:#eef2f6; border-radius:6px; overflow:hidden; border:1px solid var(--border)}
.meter>div{height:100%; width:0; background:var(--active-color,#94a3b8)}

/* Sticky minimal */
.panel-sticky{
  position:sticky; top:0; z-index:5; display:flex; align-items:center; gap:8px;
  padding:10px 12px; background:#fff; border-bottom:1px solid #f0f2f5;
}
.ps-icon svg{width:18px;height:18px}
.ps-label{font-weight:700}
.ps-dot{margin-left:auto; width:10px; height:10px; border-radius:50%; background:var(--active-color,#cbd5e1)}

/* =========================
   Sidebar / Tree
   ========================= */
.side-nav{
  position:sticky; top:var(--sticky-top); align-self:start;
  border-right:1px solid rgba(0,0,0,.06); padding-right:10px;
  max-height:calc(100vh - var(--sticky-top)); overflow:auto; background:transparent;
}
.sidebar-header{padding:10px 12px; border-bottom:1px solid #eef1f4; background:#fff}
.logo-title{font-weight:800; font-size:1rem; color:#0d47a1}

.tree{display:flex; flex-direction:column; gap:4px; margin:8px 0}
.tree-group{margin-top:2px}
.tree-children{
  list-style:none; margin:4px 0 6px 14px; padding:0 0 0 10px; border-left:1px dashed #e5e7eb;
  display:flex; flex-direction:column; gap:2px;
}
.tree-children[hidden]{display:none!important}
.tree-node,.tree-leaf{
  appearance:none; border:0; background:transparent; cursor:pointer; width:100%; text-align:left;
  padding:6px 8px 6px 6px; display:flex; align-items:center; gap:8px; border-radius:6px;
}
.tree-node:hover,.tree-leaf:hover{background:#f6f7f9}
.tree-check{margin-right:6px; accent-color:#10b981; width:16px; height:16px; cursor:pointer}
.chev{width:14px; opacity:.6; transform-origin:center}
.tree-node[aria-expanded="false"] .chev{transform:rotate(-90deg)}
.tree-node.is-active,.tree-leaf.is-active{background:#eafaf3; outline:1px solid rgba(16,185,129,.35)}
.tree-node.is-partial::after{
  content:""; position:absolute; left:-6px; top:50%; transform:translateY(-50%);
  width:6px; height:2px; border-radius:2px; background:var(--section-color); opacity:.7;
}
.tree .badge{
  margin-left:auto; padding:3px 6px; border-radius:999px; font-size:.72rem; font-weight:800; line-height:1;
  background:#f1f5f9; color:#0f172a; border:1px solid var(--border);
}

/* Mobile side */
.hamburger{display:none}
@media (max-width:960px){
  .hamburger{display:flex; width:38px; height:34px; border:0; background:transparent; align-items:center; justify-content:center; gap:5px}
  .hamburger span{width:22px; height:2px; background:#0f172a; border-radius:2px}
  #sidebar{position:fixed; inset:0 auto 0 0; width:82%; max-width:320px; background:#fff; transform:translateX(-100%); transition:transform .2s}
  body.menu-open #sidebar{transform:translateX(0)}
  .side-overlay{position:fixed; inset:0; background:rgba(16,24,40,.28); backdrop-filter:blur(2px); display:none; z-index:40}
  body.menu-open .side-overlay{display:block}
}

/* =========================
   Filtres (discrets) — incluant RÉFÉRENTIEL
   ========================= */
#energy-filters,
#energy-filters fieldset,
#energy-filters .filter-card{
  background:transparent !important; border:0 !important; box-shadow:none !important;
  padding:0; margin:6px 0 12px;
}
#energy-filters{
  display:flex; align-items:center; flex-wrap:wrap; gap:10px 14px; font-size:13.5px;
}
#energy-filters > div:not(:first-child),
#energy-filters > fieldset:not(:first-child){
  position:relative; padding-left:12px;
}
#energy-filters > div:not(:first-child)::before,
#energy-filters > fieldset:not(:first-child)::before{
  content:""; position:absolute; left:0; top:50%; width:1px; height:14px; background:var(--hairline); transform:translateY(-50%);
}

/* Libellés sobres */
#energy-filters .f-label{opacity:.65; font-weight:600; margin-right:4px}

/* --- Norme (kWh/m² vs kWh) — radios “ghost” --- */
#energy-filters input[name="norm-energy"]{
  position:absolute; inline-size:1px; block-size:1px; opacity:0; pointer-events:none;
}
#energy-filters input[name="norm-energy"] + label{
  cursor:pointer; padding:2px 0; color:#64748b; font-weight:600;
}
#energy-filters input[name="norm-energy"] + label:hover{color:#0f172a}
#energy-filters input[name="norm-energy"]:checked + label{color:#0f172a; border-bottom:2px solid var(--section-color)}

/* --- RÉFÉRENTIEL — OPTION A : radios “ghost” (bench-type-energy) --- */
#energy-filters input[name="bench-type-energy"]{
  position:absolute; inline-size:1px; block-size:1px; opacity:0; pointer-events:none;
}
#energy-filters input[name="bench-type-energy"] + label{
  cursor:pointer; padding:2px 0; color:#64748b; font-weight:600;
}
#energy-filters input[name="bench-type-energy"] + label:hover{color:#0f172a}
#energy-filters input[name="bench-type-energy"]:checked + label{color:#0f172a; border-bottom:2px solid var(--section-color)}

/* --- RÉFÉRENTIEL — OPTION B : select compact (.ref-select) --- */
#energy-filters .ref-select{
  appearance:none; border:1px solid var(--border); background:#fff;
  border-radius:8px; padding:6px 28px 6px 10px; font-weight:600; color:#0f172a;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="%23667085" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8l4 4 4-4"/></svg>');
  background-repeat:no-repeat; background-position:right 8px center; background-size:18px 18px;
}
#energy-filters .ref-select:focus{outline:0; box-shadow:0 0 0 6px var(--ring)}

/* --- Climat (switch compact) --- */
#energy-filters .ios-switch{display:flex; align-items:center; gap:8px}
#energy-filters .ios-text{font-weight:600; color:#0f172a; opacity:.8}

/* =========================
   Search (sidebar)
   ========================= */
.side-search{padding:10px 12px; background:#fff; border-bottom:1px solid #eef1f4}
.search-input{display:flex; align-items:center; gap:8px; border:1px solid var(--border); border-radius:8px; padding:6px 8px; background:#fff}
.search-input:focus-within{box-shadow:0 0 0 6px var(--ring)}
.search-input input{appearance:none; border:0; outline:0; width:100%; font-weight:600; background:transparent}
.s-ico{opacity:.6; display:inline-flex}
.s-clear{border:0; background:#f1f5f9; border-radius:6px; padding:2px 6px; cursor:pointer; font-weight:700}
.search-input input::-webkit-search-cancel-button{appearance:none; display:none}
.search-input input::-ms-clear{display:none;width:0;height:0}

/* =========================
   A11y utils
   ========================= */
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
@media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}
